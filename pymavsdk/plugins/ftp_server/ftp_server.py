# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/ftp_server/ftp_server.proto)

"""
Provide files or directories to transfer.
"""

import ctypes
from typing import Optional, List, Callable, Any
from enum import IntEnum


# ===== Enums =====

# ===== Result Enums =====
class FtpServerResult(IntEnum):
    """Possible results returned for FTP server requests."""
    UNKNOWN = 0
    SUCCESS = 1
    DOES_NOT_EXIST = 2
    BUSY = 3


# ===== Internal C Structures =====

# ===== Structures =====

# ===== Callback Types =====


class FtpServer:
    """Provide files or directories to transfer."""

    def __init__(self, lib: ctypes.CDLL, server_component):
        self._lib = lib
        self._handle = None
        self._callbacks = []  # Keep references to prevent GC

        self._setup_functions()

        # Validate input parameter
        if server_component is None:
            raise ValueError("server_component cannot be None")

        # Extract handle with validation
        if hasattr(server_component, '_handle'):
            component_handle = server_component._handle
        elif isinstance(server_component, ctypes.c_void_p):
            component_handle = server_component
        else:
            raise ValueError(f"Invalid server_component type: {type(server_component)}. Expected ServerComponent or c_void_p")

        # Validate handle is not null
        if not component_handle or (isinstance(component_handle, int) and component_handle == 0):
            raise ValueError("server_component handle is null")

        self._handle = self._lib.mavsdk_ftp_server_create(component_handle)

        # Validate plugin creation succeeded
        if not self._handle:
            raise RuntimeError("Failed to create FtpServer plugin - C function returned null handle")

    def _setup_functions(self):
        """Setup C function signatures"""

        # Create/Destroy
        self._lib.mavsdk_ftp_server_create.argtypes = [ctypes.c_void_p]
        self._lib.mavsdk_ftp_server_create.restype = ctypes.c_void_p

        self._lib.mavsdk_ftp_server_destroy.argtypes = [ctypes.c_void_p]
        self._lib.mavsdk_ftp_server_destroy.restype = None



        self._lib.mavsdk_ftp_server_set_root_dir.argtypes = [
            ctypes.c_void_p,
            ctypes.c_char_p,
        ]

        self._lib.mavsdk_ftp_server_set_root_dir.restype = ctypes.c_int



    def set_root_dir(self, path):
        """Get set_root_dir (blocking)"""
        result_code = self._lib.mavsdk_ftp_server_set_root_dir(
            self._handle,
            path        )
        result = FtpServerResult(result_code)
        if result != FtpServerResult.SUCCESS:
            raise Exception(f"set_root_dir failed: {result}")
        return result


    def destroy(self):
        """Destroy the plugin instance"""
        if self._handle:
            self._lib.mavsdk_ftp_server_destroy(self._handle)
            self._handle = None

    def __del__(self):
        self.destroy()