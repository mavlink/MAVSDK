// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/tune/tune.proto)

#include "tune.h"

#include <mavsdk/plugins/tune/tune.h>
#include <cstring>
#include <vector>

// ===== C++ to C Type Conversions =====

static mavsdk_tune_result_t
translate_result(mavsdk::Tune::Result cpp_result) {
    switch(cpp_result) {
        case mavsdk::Tune::Result::Unknown:
            return MAVSDK_TUNE_RESULT_UNKNOWN;
        case mavsdk::Tune::Result::Success:
            return MAVSDK_TUNE_RESULT_SUCCESS;
        case mavsdk::Tune::Result::InvalidTempo:
            return MAVSDK_TUNE_RESULT_INVALID_TEMPO;
        case mavsdk::Tune::Result::TuneTooLong:
            return MAVSDK_TUNE_RESULT_TUNE_TOO_LONG;
        case mavsdk::Tune::Result::Error:
            return MAVSDK_TUNE_RESULT_ERROR;
        case mavsdk::Tune::Result::NoSystem:
            return MAVSDK_TUNE_RESULT_NO_SYSTEM;
    }
}

static mavsdk::Tune::SongElement
translate_song_element_from_c(mavsdk_tune_song_element_t c_enum) {
    switch(c_enum) {
        case MAVSDK_TUNE_SONG_ELEMENT_STYLE_LEGATO:
            return mavsdk::Tune::SongElement::StyleLegato;
        case MAVSDK_TUNE_SONG_ELEMENT_STYLE_NORMAL:
            return mavsdk::Tune::SongElement::StyleNormal;
        case MAVSDK_TUNE_SONG_ELEMENT_STYLE_STACCATO:
            return mavsdk::Tune::SongElement::StyleStaccato;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_1:
            return mavsdk::Tune::SongElement::Duration1;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_2:
            return mavsdk::Tune::SongElement::Duration2;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_4:
            return mavsdk::Tune::SongElement::Duration4;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_8:
            return mavsdk::Tune::SongElement::Duration8;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_16:
            return mavsdk::Tune::SongElement::Duration16;
        case MAVSDK_TUNE_SONG_ELEMENT_DURATION_32:
            return mavsdk::Tune::SongElement::Duration32;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_A:
            return mavsdk::Tune::SongElement::NoteA;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_B:
            return mavsdk::Tune::SongElement::NoteB;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_C:
            return mavsdk::Tune::SongElement::NoteC;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_D:
            return mavsdk::Tune::SongElement::NoteD;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_E:
            return mavsdk::Tune::SongElement::NoteE;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_F:
            return mavsdk::Tune::SongElement::NoteF;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_G:
            return mavsdk::Tune::SongElement::NoteG;
        case MAVSDK_TUNE_SONG_ELEMENT_NOTE_PAUSE:
            return mavsdk::Tune::SongElement::NotePause;
        case MAVSDK_TUNE_SONG_ELEMENT_SHARP:
            return mavsdk::Tune::SongElement::Sharp;
        case MAVSDK_TUNE_SONG_ELEMENT_FLAT:
            return mavsdk::Tune::SongElement::Flat;
        case MAVSDK_TUNE_SONG_ELEMENT_OCTAVE_UP:
            return mavsdk::Tune::SongElement::OctaveUp;
        case MAVSDK_TUNE_SONG_ELEMENT_OCTAVE_DOWN:
            return mavsdk::Tune::SongElement::OctaveDown;
    }
    return mavsdk::Tune::SongElement::StyleLegato;
}

static mavsdk_tune_song_element_t
translate_song_element_to_c(mavsdk::Tune::SongElement cpp_enum) {
    switch(cpp_enum) {
        case mavsdk::Tune::SongElement::StyleLegato:
            return MAVSDK_TUNE_SONG_ELEMENT_STYLE_LEGATO;
        case mavsdk::Tune::SongElement::StyleNormal:
            return MAVSDK_TUNE_SONG_ELEMENT_STYLE_NORMAL;
        case mavsdk::Tune::SongElement::StyleStaccato:
            return MAVSDK_TUNE_SONG_ELEMENT_STYLE_STACCATO;
        case mavsdk::Tune::SongElement::Duration1:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_1;
        case mavsdk::Tune::SongElement::Duration2:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_2;
        case mavsdk::Tune::SongElement::Duration4:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_4;
        case mavsdk::Tune::SongElement::Duration8:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_8;
        case mavsdk::Tune::SongElement::Duration16:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_16;
        case mavsdk::Tune::SongElement::Duration32:
            return MAVSDK_TUNE_SONG_ELEMENT_DURATION_32;
        case mavsdk::Tune::SongElement::NoteA:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_A;
        case mavsdk::Tune::SongElement::NoteB:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_B;
        case mavsdk::Tune::SongElement::NoteC:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_C;
        case mavsdk::Tune::SongElement::NoteD:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_D;
        case mavsdk::Tune::SongElement::NoteE:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_E;
        case mavsdk::Tune::SongElement::NoteF:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_F;
        case mavsdk::Tune::SongElement::NoteG:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_G;
        case mavsdk::Tune::SongElement::NotePause:
            return MAVSDK_TUNE_SONG_ELEMENT_NOTE_PAUSE;
        case mavsdk::Tune::SongElement::Sharp:
            return MAVSDK_TUNE_SONG_ELEMENT_SHARP;
        case mavsdk::Tune::SongElement::Flat:
            return MAVSDK_TUNE_SONG_ELEMENT_FLAT;
        case mavsdk::Tune::SongElement::OctaveUp:
            return MAVSDK_TUNE_SONG_ELEMENT_OCTAVE_UP;
        case mavsdk::Tune::SongElement::OctaveDown:
            return MAVSDK_TUNE_SONG_ELEMENT_OCTAVE_DOWN;
    }
    return MAVSDK_TUNE_SONG_ELEMENT_STYLE_LEGATO;
}



static mavsdk::Tune::TuneDescription
translate_tune_description_from_c(const mavsdk_tune_tune_description_t& c_struct) {
    mavsdk::Tune::TuneDescription cpp_struct{};
    cpp_struct.song_elements.reserve(c_struct.song_elements_size);
    for (size_t i = 0; i < c_struct.song_elements_size; i++) {
        cpp_struct.song_elements.push_back(
            translate_song_element_from_c(c_struct.song_elements[i]));
    }
    cpp_struct.tempo = c_struct.tempo;
    return cpp_struct;
}

static mavsdk_tune_tune_description_t
translate_tune_description_to_c(const mavsdk::Tune::TuneDescription& cpp_struct) {
    mavsdk_tune_tune_description_t c_struct{};
    c_struct.song_elements_size = cpp_struct.song_elements.size();
    c_struct.song_elements = new mavsdk_tune_song_element_t[c_struct.song_elements_size];
    for (size_t i = 0; i < c_struct.song_elements_size; i++) {
        c_struct.song_elements[i] = translate_song_element_to_c(cpp_struct.song_elements[i]);
    }
    c_struct.tempo = cpp_struct.tempo;
    return c_struct;
}

void mavsdk_tune_tune_description_destroy(
    mavsdk_tune_tune_description_t* target) {
    if (!target) return;
    if (target->song_elements) {
        delete[] target->song_elements;
        target->song_elements = nullptr;
        target->song_elements_size = 0;
    }
}

void mavsdk_tune_tune_description_array_destroy(
    mavsdk_tune_tune_description_t** array,
    size_t size) {
    if (!array || !*array) return;

    for (size_t i = 0; i < size; i++) {
        mavsdk_tune_tune_description_destroy(&(*array)[i]);
    }

    delete[] *array;
    *array = nullptr;
}



// ===== Primitive Array Destroy Functions =====
void mavsdk_tune_float_array_destroy(float** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_double_array_destroy(double** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_int32t_array_destroy(int32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_uint32t_array_destroy(uint32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_int64t_array_destroy(int64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_uint64t_array_destroy(uint64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_tune_bool_array_destroy(bool** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}


void mavsdk_tune_string_destroy(char** str) {
    if (!str || !*str) return;
    free(*str);
    *str = nullptr;
}

void mavsdk_tune_byte_buffer_destroy(uint8_t** buffer) {
    if (!buffer || !*buffer) return;
    delete[] *buffer;
    *buffer = nullptr;
}

// ===== Tune Wrapper =====

struct mavsdk_tune_wrapper {
    std::shared_ptr<mavsdk::Tune> cpp_plugin;
};

mavsdk_tune_t
mavsdk_tune_create(mavsdk_system_t system) {
    if (system == nullptr) {
        return nullptr;
    }

    auto wrapper = new mavsdk_tune_wrapper();
    auto system_ptr = static_cast<std::shared_ptr<mavsdk::System>*>(system);
    wrapper->cpp_plugin = std::make_shared<mavsdk::Tune>(*system_ptr);

    return wrapper;
}

void mavsdk_tune_destroy(mavsdk_tune_t tune) {
    if (tune == nullptr) {
        return;
    }

    auto wrapper = static_cast<mavsdk_tune_wrapper*>(tune);
    delete wrapper;
}

// ===== Method Implementations =====

// PlayTune async
void mavsdk_tune_play_tune_async(
    mavsdk_tune_t tune,
    mavsdk_tune_tune_description_t tune_description,
    mavsdk_tune_play_tune_callback_t callback,
    void* user_data)
{
    auto wrapper = static_cast<mavsdk_tune_wrapper*>(tune);

    wrapper->cpp_plugin->play_tune_async(
        translate_tune_description_from_c(tune_description),
        [callback, user_data](
            mavsdk::Tune::Result result) {
                if (callback) {
                    callback(
                        translate_result(result),
                        user_data);
                }
        });
}


// PlayTune sync
mavsdk_tune_result_t
mavsdk_tune_play_tune(
    mavsdk_tune_t tune,
    mavsdk_tune_tune_description_t tune_description)
{
    auto wrapper = static_cast<mavsdk_tune_wrapper*>(tune);

    auto ret_value = wrapper->cpp_plugin->play_tune(        translate_tune_description_from_c(tune_description));

    return translate_result(ret_value);
}
