# ruff: noqa: F401

# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/offboard/offboard.proto)

"""
Control a drone with position, velocity, attitude or motor commands.

 The module is called offboard because the commands can be sent from external sources
 as opposed to onboard control right inside the autopilot "board".

 Client code must specify a setpoint before starting offboard mode.
 Mavsdk automatically sends setpoints at 20Hz (PX4 Offboard mode requires that setpoints
 are minimally sent at 2Hz).
"""

import asyncio
from typing import AsyncGenerator

from pymavsdk.plugins.offboard import (
    Offboard,
    Attitude,
    ActuatorControlGroup,
    ActuatorControl,
    AttitudeRate,
    PositionNedYaw,
    PositionGlobalYaw,
    VelocityBodyYawspeed,
    VelocityNedYaw,
    AccelerationNed,
)


class OffboardError(Exception):
    """Raised when a Offboard operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class OffboardAsync:
    """
       Control a drone with position, velocity, attitude or motor commands.

    The module is called offboard because the commands can be sent from external sources
    as opposed to onboard control right inside the autopilot "board".

    Client code must specify a setpoint before starting offboard mode.
    Mavsdk automatically sends setpoints at 20Hz (PX4 Offboard mode requires that setpoints
    are minimally sent at 2Hz).

       Async wrapper around :class:`Offboard` that mirrors the gRPC-based
       asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, system):
        self._plugin = Offboard(system._system)

    async def start(self):
        """
        Start offboard control.

        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.start())

    async def stop(self):
        """
               Stop offboard control.

        The vehicle will be put into Hold mode: https://docs.px4.io/en/flight_modes/hold.html

               Raises
               ------
               OffboardError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.stop())

    async def is_active(self):
        """
               Check if offboard control is active.

        True means that the vehicle is in offboard mode and we are actively sending
        setpoints.

               Returns
               -------
               <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080d9550> :
               Raises
               ------
               OffboardError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.is_active())

    async def set_attitude(self, attitude):
        """
        Set the attitude in terms of roll, pitch and yaw in degrees with thrust.

        Parameters
        ----------
        attitude : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db830>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_attitude(attitude)
        )

    async def set_actuator_control(self, actuator_control):
        """
               Set direct actuator control values to groups #0 and #1.

        First 8 controls will go to control group 0, the following 8 controls to control group 1 (if
        actuator_control.num_controls more than 8).

               Parameters
               ----------
               actuator_control : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db830>
               Raises
               ------
               OffboardError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_actuator_control(actuator_control)
        )

    async def set_attitude_rate(self, attitude_rate):
        """
        Set the attitude rate in terms of pitch, roll and yaw angular rate along with thrust.

        Parameters
        ----------
        attitude_rate : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db830>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_attitude_rate(attitude_rate)
        )

    async def set_position_ned(self, position_ned_yaw):
        """
        Set the position in NED coordinates and yaw.

        Parameters
        ----------
        position_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db830>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_position_ned(position_ned_yaw)
        )

    async def set_position_global(self, position_global_yaw):
        """
        Set the position in Global coordinates (latitude, longitude, altitude) and yaw

        Parameters
        ----------
        position_global_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db830>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_position_global(position_global_yaw)
        )

    async def set_velocity_body(self, velocity_body_yawspeed):
        """
        Set the velocity in body coordinates and yaw angular rate. Not available for fixed-wing aircraft.

        Parameters
        ----------
        velocity_body_yawspeed : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_velocity_body(velocity_body_yawspeed)
        )

    async def set_velocity_ned(self, velocity_ned_yaw):
        """
        Set the velocity in NED coordinates and yaw. Not available for fixed-wing aircraft.

        Parameters
        ----------
        velocity_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_velocity_ned(velocity_ned_yaw)
        )

    async def set_position_velocity_ned(self, position_ned_yaw, velocity_ned_yaw):
        """
        Set the position in NED coordinates, with the velocity to be used as feed-forward.

        Parameters
        ----------
        position_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        velocity_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.set_position_velocity_ned(
                position_ned_yaw, velocity_ned_yaw
            ),
        )

    async def set_position_velocity_acceleration_ned(
        self, position_ned_yaw, velocity_ned_yaw, acceleration_ned
    ):
        """
        Set the position, velocity and acceleration in NED coordinates, with velocity and acceleration used as feed-forward.

        Parameters
        ----------
        position_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        velocity_ned_yaw : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        acceleration_ned : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.set_position_velocity_acceleration_ned(
                position_ned_yaw, velocity_ned_yaw, acceleration_ned
            ),
        )

    async def set_acceleration_ned(self, acceleration_ned):
        """
        Set the acceleration in NED coordinates.

        Parameters
        ----------
        acceleration_ned : <protoc_gen_mavsdk.name_parser.NameParser object at 0x1080db050>
        Raises
        ------
        OffboardError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_acceleration_ned(acceleration_ned)
        )
