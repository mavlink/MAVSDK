# ruff: noqa: F401

# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/log_files/log_files.proto)

"""
Allow to download log files from the vehicle after a flight is complete.
 For log streaming during flight check the logging plugin.
"""

import asyncio
from typing import AsyncGenerator

from pymavsdk.plugins.log_files import (
    LogFiles,
    ProgressData,
    Entry,
)


class LogFilesError(Exception):
    """Raised when a LogFiles operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class LogFilesAsync:
    """
       Allow to download log files from the vehicle after a flight is complete.
    For log streaming during flight check the logging plugin.

       Async wrapper around :class:`LogFiles` that mirrors the gRPC-based
       asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, system):
        self._plugin = LogFiles(system._system)

    async def get_entries(self):
        """
        Get List of log files.

        Returns
        -------
        <protoc_gen_mavsdk.name_parser.NameParser object at 0x10638bbf0> : Entry
        Raises
        ------
        LogFilesError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.get_entries())

    async def erase_all_log_files(self):
        """
        Erase all log files.

        Raises
        ------
        LogFilesError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.erase_all_log_files()
        )
