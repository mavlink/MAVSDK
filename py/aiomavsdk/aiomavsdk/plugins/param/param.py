# ruff: noqa: F401
# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/param/param.proto)
"""
Provide raw access to get and set parameters.
"""

import asyncio
from typing import AsyncGenerator
from pymavsdk.plugins.param import (
    Param,
    ParamResult,
    ProtocolVersion,
    IntParam,
    FloatParam,
    CustomParam,
    AllParams,
)


class ParamError(Exception):
    """Raised when a Param operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class ParamAsync:
    """
    Provide raw access to get and set parameters.

    Async wrapper around :class:`Param` that mirrors the gRPC-based
    asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, system):
        self._subscription_handles: dict = {}
        self._plugin = Param(system._system)

    async def get_param_int(self, name):
        """
               Get an int parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               Returns
               -------
               <protoc_gen_mavsdk.name_parser.NameParser object at 0x107ba0770> :
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.get_param_int(name)
        )

    async def set_param_int(self, name, value):
        """
               Set an int parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               value : int32_t
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_param_int(name, value)
        )

    async def get_param_float(self, name):
        """
               Get a float parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               Returns
               -------
               <protoc_gen_mavsdk.name_parser.NameParser object at 0x107ba0b30> :
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.get_param_float(name)
        )

    async def set_param_float(self, name, value):
        """
               Set a float parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               value : float
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_param_float(name, value)
        )

    async def get_param_custom(self, name):
        """
               Get a custom parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               Returns
               -------
               <protoc_gen_mavsdk.name_parser.NameParser object at 0x107ba0f50> :
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.get_param_custom(name)
        )

    async def set_param_custom(self, name, value):
        """
               Set a custom parameter.

        If the type is wrong, the result will be `WRONG_TYPE`.

               Parameters
               ----------
               name : std::string
               value : std::string
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_param_custom(name, value)
        )

    async def get_all_params(self):
        """
        Get all parameters.

        Returns
        -------
        <protoc_gen_mavsdk.name_parser.NameParser object at 0x107ba12b0> : AllParams
        Raises
        ------
        ParamError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.get_all_params())

    async def select_component(self, component_id, protocol_version):
        """
               Select component ID of parameter component to talk to and param protocol version.

        Default is the autopilot component (1), and Version (0).

               Parameters
               ----------
               component_id : int32_t
               protocol_version : <protoc_gen_mavsdk.name_parser.NameParser object at 0x107ba2090>
               Raises
               ------
               ParamError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.select_component(component_id, protocol_version)
        )

    def destroy(self):
        self._subscription_handles.clear()
        self._plugin.destroy()

    def __del__(self):
        self.destroy()
