# ruff: noqa: F401

# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/action/action.proto)

"""
Enable simple actions such as arming, taking off, and landing.
"""

import asyncio
from typing import AsyncGenerator

from pymavsdk.plugins.action import (
    Action,
    OrbitYawBehavior,
    RelayCommand,
)


class ActionError(Exception):
    """Raised when a Action operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class ActionAsync:
    """
    Enable simple actions such as arming, taking off, and landing.

    Async wrapper around :class:`Action` that mirrors the gRPC-based
    asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, system):
        self._plugin = Action(system._system)

    async def arm(self):
        """
               Send command to arm the drone.

        Arming a drone normally causes motors to spin at idle.
        Before arming take all safety precautions and stand clear of the drone!

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.arm())

    async def arm_force(self):
        """
               Send command to force-arm the drone without any checks.

        Attention: this is not to be used for normal flying but only bench tests!

        Arming a drone normally causes motors to spin at idle.
        Before arming take all safety precautions and stand clear of the drone!

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.arm_force())

    async def disarm(self):
        """
               Send command to disarm the drone.

        This will disarm a drone that considers itself landed. If flying, the drone should
        reject the disarm command. Disarming means that all motors will stop.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.disarm())

    async def takeoff(self):
        """
               Send command to take off and hover.

        This switches the drone into position control mode and commands
        it to take off and hover at the takeoff altitude.

        Note that the vehicle must be armed before it can take off.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.takeoff())

    async def land(self):
        """
               Send command to land at the current position.

        This switches the drone to 'Land' flight mode.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.land())

    async def reboot(self):
        """
               Send command to reboot the drone components.

        This will reboot the autopilot, companion computer, camera and gimbal.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.reboot())

    async def shutdown(self):
        """
               Send command to shut down the drone components.

        This will shut down the autopilot, onboard computer, camera and gimbal.
        This command should only be used when the autopilot is disarmed and autopilots commonly
        reject it if they are not already ready to shut down.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.shutdown())

    async def terminate(self):
        """
               Send command to terminate the drone.

        This will run the terminate routine as configured on the drone (e.g. disarm and open the parachute).

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.terminate())

    async def kill(self):
        """
               Send command to kill the drone.

        This will disarm a drone irrespective of whether it is landed or flying.
        Note that the drone will fall out of the sky if this command is used while flying.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.kill())

    async def return_to_launch(self):
        """
               Send command to return to the launch (takeoff) position and land.

        This switches the drone into [Return mode](https://docs.px4.io/master/en/flight_modes/return.html) which
        generally means it will rise up to a certain altitude to clear any obstacles before heading
        back to the launch (takeoff) position and land there.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.return_to_launch())

    async def goto_location(
        self, latitude_deg, longitude_deg, absolute_altitude_m, yaw_deg
    ):
        """
               Send command to move the vehicle to a specific global position.

        The latitude and longitude are given in degrees (WGS84 frame) and the altitude
        in meters AMSL (above mean sea level).

        The yaw angle is in degrees (frame is NED, 0 is North, positive is clockwise).

               Parameters
               ----------
               latitude_deg : double
               longitude_deg : double
               absolute_altitude_m : float
               yaw_deg : float
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.goto_location(
                latitude_deg, longitude_deg, absolute_altitude_m, yaw_deg
            ),
        )

    async def do_orbit(
        self,
        radius_m,
        velocity_ms,
        yaw_behavior,
        latitude_deg,
        longitude_deg,
        absolute_altitude_m,
    ):
        """
               Send command do orbit to the drone.

        This will run the orbit routine with the given parameters.

               Parameters
               ----------
               radius_m : float
               velocity_ms : float
               yaw_behavior : <protoc_gen_mavsdk.name_parser.NameParser object at 0x105fd2ff0>
               latitude_deg : double
               longitude_deg : double
               absolute_altitude_m : double
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.do_orbit(
                radius_m,
                velocity_ms,
                yaw_behavior,
                latitude_deg,
                longitude_deg,
                absolute_altitude_m,
            ),
        )

    async def hold(self):
        """
               Send command to hold position (a.k.a. "Loiter").

        Sends a command to drone to change to Hold flight mode, causing the
        vehicle to stop and maintain its current GPS position and altitude.

        Note: this command is specific to the PX4 Autopilot flight stack as
        it implies a change to a PX4-specific mode.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.hold())

    async def set_actuator(self, index, value):
        """
               Send command to set the value of an actuator.

        Note that the index of the actuator starts at 1 and that the value goes from -1 to 1.

               Parameters
               ----------
               index : int32_t
               value : float
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_actuator(index, value)
        )

    async def set_relay(self, index, setting):
        """
               Send command to set the value of a relay.

        The index of the relay starts at 0.
        For the relay value, 1=on, 0=off, others possible depending on system hardware

               Parameters
               ----------
               index : int32_t
               setting : <protoc_gen_mavsdk.name_parser.NameParser object at 0x105fd2ff0>
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_relay(index, setting)
        )

    async def transition_to_fixedwing(self):
        """
               Send command to transition the drone to fixedwing.

        The associated action will only be executed for VTOL vehicles (on other vehicle types the
        command will fail). The command will succeed if called when the vehicle
        is already in fixedwing mode.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.transition_to_fixedwing()
        )

    async def transition_to_multicopter(self):
        """
               Send command to transition the drone to multicopter.

        The associated action will only be executed for VTOL vehicles (on other vehicle types the
        command will fail). The command will succeed if called when the vehicle
        is already in multicopter mode.

               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.transition_to_multicopter()
        )

    async def get_takeoff_altitude(self):
        """
        Get the takeoff altitude (in meters above ground).

        Returns
        -------
        <protoc_gen_mavsdk.name_parser.NameParser object at 0x105fd2210> :
        Raises
        ------
        ActionError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.get_takeoff_altitude()
        )

    async def set_takeoff_altitude(self, altitude):
        """
        Set takeoff altitude (in meters above ground).

        Parameters
        ----------
        altitude : float
        Raises
        ------
        ActionError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_takeoff_altitude(altitude)
        )

    async def get_return_to_launch_altitude(self):
        """
        Get the return to launch minimum return altitude (in meters).

        Returns
        -------
        <protoc_gen_mavsdk.name_parser.NameParser object at 0x105fd2630> :
        Raises
        ------
        ActionError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.get_return_to_launch_altitude()
        )

    async def set_return_to_launch_altitude(self, relative_altitude_m):
        """
        Set the return to launch minimum return altitude (in meters).

        Parameters
        ----------
        relative_altitude_m : float
        Raises
        ------
        ActionError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.set_return_to_launch_altitude(relative_altitude_m),
        )

    async def set_current_speed(self, speed_m_s):
        """
               Set current speed.

        This will set the speed during a mission, reposition, and similar.
        It is ephemeral, so not stored on the drone and does not survive a reboot.

               Parameters
               ----------
               speed_m_s : float
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.set_current_speed(speed_m_s)
        )

    async def set_gps_global_origin(
        self, latitude_deg, longitude_deg, absolute_altitude_m
    ):
        """
               Set GPS Global Origin.

        Sets the GPS coordinates of the vehicle local origin (0,0,0) position.

               Parameters
               ----------
               latitude_deg : double
               longitude_deg : double
               absolute_altitude_m : float
               Raises
               ------
               ActionError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.set_gps_global_origin(
                latitude_deg, longitude_deg, absolute_altitude_m
            ),
        )
