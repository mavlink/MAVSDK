# ruff: noqa: F401
# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/ftp_server/ftp_server.proto)
"""
Provide files or directories to transfer.
"""

import asyncio
from typing import AsyncGenerator
from mavsdk.plugins.ftp_server import (
    FtpServer,
    FtpServerResult,
)


class FtpServerError(Exception):
    """Raised when a FtpServer operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class FtpServerAsync:
    """
    Provide files or directories to transfer.

    Async wrapper around :class:`FtpServer` that mirrors the gRPC-based
    asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, server_component):
        self._subscription_handles: dict = {}
        self._plugin = FtpServer(server_component)

    async def set_root_dir(self, path):
        """
               Set root directory.

        This is the directory that can then be accessed by a client.
        The directory needs to exist when this is called.
        The permissions are the same as the file permission for the user running the server.
        The root directory can't be changed while an FTP process is in progress.

               Parameters
               ----------
               path : std::string
               Raises
               ------
               FtpServerError
                   If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.set_root_dir(path))

    def destroy(self):
        self._subscription_handles.clear()
        self._plugin.destroy()

    def __del__(self):
        self.destroy()
