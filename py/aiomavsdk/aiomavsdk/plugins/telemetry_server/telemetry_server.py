# ruff: noqa: F401
# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/telemetry_server/telemetry_server.proto)
"""
Allow users to provide vehicle telemetry and state information
 (e.g. battery, GPS, RC connection, flight mode etc.) and set telemetry update rates.
"""

import asyncio
from typing import AsyncGenerator
from mavsdk.plugins.telemetry_server import (
    TelemetryServer,
    TelemetryServerResult,
    FixType,
    VtolState,
    StatusTextType,
    LandedState,
    Position,
    Heading,
    Quaternion,
    EulerAngle,
    AngularVelocityBody,
    GpsInfo,
    RawGps,
    Battery,
    RcStatus,
    StatusText,
    ActuatorControlTarget,
    ActuatorOutputStatus,
    Covariance,
    VelocityBody,
    PositionBody,
    Odometry,
    DistanceSensor,
    ScaledPressure,
    PositionNed,
    VelocityNed,
    PositionVelocityNed,
    GroundTruth,
    FixedwingMetrics,
    AccelerationFrd,
    AngularVelocityFrd,
    MagneticFieldFrd,
    Imu,
)


class TelemetryServerError(Exception):
    """Raised when a TelemetryServer operation fails."""

    def __init__(self, result, origin, *params):
        self._result = result
        self._origin = origin
        self._params = params

    def __str__(self):
        return f"{self._result}: '{self._result.name}'; origin: {self._origin}; params: {self._params}"


class TelemetryServerAsync:
    """
       Allow users to provide vehicle telemetry and state information
    (e.g. battery, GPS, RC connection, flight mode etc.) and set telemetry update rates.

       Async wrapper around :class:`TelemetryServer` that mirrors the gRPC-based
       asyncio API while using the ctypes-based C library directly.
    """

    def __init__(self, server_component):
        self._subscription_handles: dict = {}
        self._plugin = TelemetryServer(server_component)

    async def publish_position(self, position, velocity_ned, heading):
        """
        Publish to 'position' updates.

        Parameters
        ----------
        position : Position
        velocity_ned : VelocityNed
        heading : Heading
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_position(position, velocity_ned, heading)
        )

    async def publish_home(self, home):
        """
        Publish to 'home position' updates.

        Parameters
        ----------
        home : Position
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.publish_home(home))

    async def publish_sys_status(
        self,
        battery,
        rc_receiver_status,
        gyro_status,
        accel_status,
        mag_status,
        gps_status,
    ):
        """
        Publish 'sys status' updates.

        Parameters
        ----------
        battery : Battery
        rc_receiver_status : bool
        gyro_status : bool
        accel_status : bool
        mag_status : bool
        gps_status : bool
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.publish_sys_status(
                battery,
                rc_receiver_status,
                gyro_status,
                accel_status,
                mag_status,
                gps_status,
            ),
        )

    async def publish_extended_sys_state(self, vtol_state, landed_state):
        """
        Publish 'extended sys state' updates.

        Parameters
        ----------
        vtol_state : VtolState
        landed_state : LandedState
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.publish_extended_sys_state(vtol_state, landed_state),
        )

    async def publish_raw_gps(self, raw_gps, gps_info):
        """
        Publish to 'Raw GPS' updates.

        Parameters
        ----------
        raw_gps : RawGps
        gps_info : GpsInfo
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_raw_gps(raw_gps, gps_info)
        )

    async def publish_battery(self, battery):
        """
        Publish to 'battery' updates.

        Parameters
        ----------
        battery : Battery
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_battery(battery)
        )

    async def publish_status_text(self, status_text):
        """
        Publish to 'status text' updates.

        Parameters
        ----------
        status_text : StatusText
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_status_text(status_text)
        )

    async def publish_odometry(self, odometry):
        """
        Publish to 'odometry' updates.

        Parameters
        ----------
        odometry : Odometry
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_odometry(odometry)
        )

    async def publish_position_velocity_ned(self, position_velocity_ned):
        """
        Publish to 'position velocity' updates.

        Parameters
        ----------
        position_velocity_ned : PositionVelocityNed
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.publish_position_velocity_ned(position_velocity_ned),
        )

    async def publish_ground_truth(self, ground_truth):
        """
        Publish to 'ground truth' updates.

        Parameters
        ----------
        ground_truth : GroundTruth
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_ground_truth(ground_truth)
        )

    async def publish_imu(self, imu):
        """
        Publish to 'IMU' updates (in SI units in NED body frame).

        Parameters
        ----------
        imu : Imu
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(None, lambda: self._plugin.publish_imu(imu))

    async def publish_scaled_imu(self, imu):
        """
        Publish to 'Scaled IMU' updates.

        Parameters
        ----------
        imu : Imu
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_scaled_imu(imu)
        )

    async def publish_raw_imu(self, imu):
        """
        Publish to 'Raw IMU' updates.

        Parameters
        ----------
        imu : Imu
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_raw_imu(imu)
        )

    async def publish_unix_epoch_time(self, time_us):
        """
        Publish to 'unix epoch time' updates.

        Parameters
        ----------
        time_us : int
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_unix_epoch_time(time_us)
        )

    async def publish_distance_sensor(self, distance_sensor):
        """
        Publish to "distance sensor" updates.

        Parameters
        ----------
        distance_sensor : DistanceSensor
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_distance_sensor(distance_sensor)
        )

    async def publish_attitude(self, angle, angular_velocity):
        """
        Publish to "attitude" updates.

        Parameters
        ----------
        angle : EulerAngle
        angular_velocity : AngularVelocityBody
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None, lambda: self._plugin.publish_attitude(angle, angular_velocity)
        )

    async def publish_visual_flight_rules_hud(self, fixed_wing_metrics):
        """
        Publish to "Visual Flight Rules HUD" updates.

        Parameters
        ----------
        fixed_wing_metrics : FixedwingMetrics
        Raises
        ------
        TelemetryServerError
            If the request fails. The error contains the reason for the failure.
        """
        loop = asyncio.get_running_loop()
        return await loop.run_in_executor(
            None,
            lambda: self._plugin.publish_visual_flight_rules_hud(fixed_wing_metrics),
        )

    def destroy(self):
        self._subscription_handles.clear()
        self._plugin.destroy()

    def __del__(self):
        self.destroy()
