# ruff: noqa: F401

# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/mission_raw/mission_raw.proto)

"""
Enable raw missions as exposed by MAVLink.
"""

import ctypes

from typing import Callable, Any
from enum import IntEnum

from ...cmavsdk_loader import _cmavsdk_lib


# ===== Enums =====


# ===== Result Enums =====
class MissionRawResult(IntEnum):
    """Possible results returned for action requests."""

    UNKNOWN = 0
    SUCCESS = 1
    ERROR = 2
    TOO_MANY_MISSION_ITEMS = 3
    BUSY = 4
    TIMEOUT = 5
    INVALID_ARGUMENT = 6
    UNSUPPORTED = 7
    NO_MISSION_AVAILABLE = 8
    TRANSFER_CANCELLED = 9
    FAILED_TO_OPEN_QGC_PLAN = 10
    FAILED_TO_PARSE_QGC_PLAN = 11
    NO_SYSTEM = 12
    DENIED = 13
    MISSION_TYPE_NOT_CONSISTENT = 14
    INVALID_SEQUENCE = 15
    CURRENT_INVALID = 16
    PROTOCOL_ERROR = 17
    INT_MESSAGES_NOT_SUPPORTED = 18
    FAILED_TO_OPEN_MISSION_PLANNER_PLAN = 19
    FAILED_TO_PARSE_MISSION_PLANNER_PLAN = 20


# ===== Internal C Structures =====
class MissionProgressCStruct(ctypes.Structure):
    """
    Internal C structure for MissionProgress.
    Used only for C library communication.
    """

    _fields_ = [
        ("current", ctypes.c_int32),
        ("total", ctypes.c_int32),
    ]


class MissionItemCStruct(ctypes.Structure):
    """
    Internal C structure for MissionItem.
    Used only for C library communication.
    """

    _fields_ = [
        ("seq", ctypes.c_uint32),
        ("frame", ctypes.c_uint32),
        ("command", ctypes.c_uint32),
        ("current", ctypes.c_uint32),
        ("autocontinue", ctypes.c_uint32),
        ("param1", ctypes.c_float),
        ("param2", ctypes.c_float),
        ("param3", ctypes.c_float),
        ("param4", ctypes.c_float),
        ("x", ctypes.c_int32),
        ("y", ctypes.c_int32),
        ("z", ctypes.c_float),
        ("mission_type", ctypes.c_uint32),
    ]


class MissionImportDataCStruct(ctypes.Structure):
    """
    Internal C structure for MissionImportData.
    Used only for C library communication.
    """

    _fields_ = [
        ("mission_items", ctypes.POINTER(MissionItemCStruct)),
        ("mission_items_size", ctypes.c_size_t),
        ("geofence_items", ctypes.POINTER(MissionItemCStruct)),
        ("geofence_items_size", ctypes.c_size_t),
        ("rally_items", ctypes.POINTER(MissionItemCStruct)),
        ("rally_items_size", ctypes.c_size_t),
    ]


# ===== Structures =====
class MissionProgress:
    """
    Mission progress type.
    """

    def __init__(self, current=None, total=None):
        self.current = current
        self.total = total

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.current = c_struct.current
        instance.total = c_struct.total
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = MissionProgressCStruct()
        c_struct.current = self.current
        c_struct.total = self.total
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"current={self.current}")
        fields.append(f"total={self.total}")
        return f"MissionProgress({', '.join(fields)})"


class MissionItem:
    """
    Mission item exactly identical to MAVLink MISSION_ITEM_INT.
    """

    def __init__(
        self,
        seq=None,
        frame=None,
        command=None,
        current=None,
        autocontinue=None,
        param1=None,
        param2=None,
        param3=None,
        param4=None,
        x=None,
        y=None,
        z=None,
        mission_type=None,
    ):
        self.seq = seq
        self.frame = frame
        self.command = command
        self.current = current
        self.autocontinue = autocontinue
        self.param1 = param1
        self.param2 = param2
        self.param3 = param3
        self.param4 = param4
        self.x = x
        self.y = y
        self.z = z
        self.mission_type = mission_type

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.seq = c_struct.seq
        instance.frame = c_struct.frame
        instance.command = c_struct.command
        instance.current = c_struct.current
        instance.autocontinue = c_struct.autocontinue
        instance.param1 = c_struct.param1
        instance.param2 = c_struct.param2
        instance.param3 = c_struct.param3
        instance.param4 = c_struct.param4
        instance.x = c_struct.x
        instance.y = c_struct.y
        instance.z = c_struct.z
        instance.mission_type = c_struct.mission_type
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = MissionItemCStruct()
        c_struct.seq = self.seq
        c_struct.frame = self.frame
        c_struct.command = self.command
        c_struct.current = self.current
        c_struct.autocontinue = self.autocontinue
        c_struct.param1 = self.param1
        c_struct.param2 = self.param2
        c_struct.param3 = self.param3
        c_struct.param4 = self.param4
        c_struct.x = self.x
        c_struct.y = self.y
        c_struct.z = self.z
        c_struct.mission_type = self.mission_type
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"seq={self.seq}")
        fields.append(f"frame={self.frame}")
        fields.append(f"command={self.command}")
        fields.append(f"current={self.current}")
        fields.append(f"autocontinue={self.autocontinue}")
        fields.append(f"param1={self.param1}")
        fields.append(f"param2={self.param2}")
        fields.append(f"param3={self.param3}")
        fields.append(f"param4={self.param4}")
        fields.append(f"x={self.x}")
        fields.append(f"y={self.y}")
        fields.append(f"z={self.z}")
        fields.append(f"mission_type={self.mission_type}")
        return f"MissionItem({', '.join(fields)})"


class MissionImportData:
    """
    Mission import data
    """

    def __init__(self, mission_items=None, geofence_items=None, rally_items=None):
        self.mission_items = mission_items or []
        self.geofence_items = geofence_items or []
        self.rally_items = rally_items or []

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        if c_struct.mission_items_size > 0:
            instance.mission_items = [
                MissionItem.from_c_struct(c_struct.mission_items[i])
                for i in range(c_struct.mission_items_size)
            ]
        else:
            instance.mission_items = []
        if c_struct.geofence_items_size > 0:
            instance.geofence_items = [
                MissionItem.from_c_struct(c_struct.geofence_items[i])
                for i in range(c_struct.geofence_items_size)
            ]
        else:
            instance.geofence_items = []
        if c_struct.rally_items_size > 0:
            instance.rally_items = [
                MissionItem.from_c_struct(c_struct.rally_items[i])
                for i in range(c_struct.rally_items_size)
            ]
        else:
            instance.rally_items = []
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = MissionImportDataCStruct()
        array_type = MissionItemCStruct * len(self.mission_items)
        c_array = array_type()
        for i, item in enumerate(self.mission_items):
            c_array[i] = item.to_c_struct()
        c_struct.mission_items = ctypes.cast(
            c_array, ctypes.POINTER(MissionItemCStruct)
        )
        c_struct.mission_items_size = len(self.mission_items)
        array_type = MissionItemCStruct * len(self.geofence_items)
        c_array = array_type()
        for i, item in enumerate(self.geofence_items):
            c_array[i] = item.to_c_struct()
        c_struct.geofence_items = ctypes.cast(
            c_array, ctypes.POINTER(MissionItemCStruct)
        )
        c_struct.geofence_items_size = len(self.geofence_items)
        array_type = MissionItemCStruct * len(self.rally_items)
        c_array = array_type()
        for i, item in enumerate(self.rally_items):
            c_array[i] = item.to_c_struct()
        c_struct.rally_items = ctypes.cast(c_array, ctypes.POINTER(MissionItemCStruct))
        c_struct.rally_items_size = len(self.rally_items)
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"mission_items={self.mission_items}")
        fields.append(f"geofence_items={self.geofence_items}")
        fields.append(f"rally_items={self.rally_items}")
        return f"MissionImportData({', '.join(fields)})"


# ===== Plugin =====
class MissionRaw:
    """Enable raw missions as exposed by MAVLink."""

    def __init__(self, system):
        self._lib = _cmavsdk_lib
        self._handle = None
        self._callbacks = []  # Keep references to prevent GC

        if system is None:
            raise ValueError("system cannot be None")

        system_handle = system._handle

        if not system_handle:
            raise ValueError("system handle is null")

        self._handle = self._lib.mavsdk_mission_raw_create(system_handle)

        if not self._handle:
            raise RuntimeError(
                "Failed to create MissionRaw plugin - C function returned null handle"
            )

    def upload_mission_async(
        self, mission_items, callback: Callable, user_data: Any = None
    ):
        """Upload a list of raw mission items to the system.

        The raw mission items are uploaded to a drone. Once uploaded the mission
        can be started and executed even if the connection is lost."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in upload_mission callback: {e}")

        cb = UploadMissionCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_upload_mission_async(
            self._handle, mission_items, cb, None
        )

    def upload_mission(self, mission_items):
        """Get upload_mission (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_upload_mission(
            self._handle,
            mission_items.to_c_struct(),
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"upload_mission failed: {result}")

        return result

    def upload_geofence_async(
        self, mission_items, callback: Callable, user_data: Any = None
    ):
        """Upload a list of geofence items to the system."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in upload_geofence callback: {e}")

        cb = UploadGeofenceCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_upload_geofence_async(
            self._handle, mission_items, cb, None
        )

    def upload_geofence(self, mission_items):
        """Get upload_geofence (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_upload_geofence(
            self._handle,
            mission_items.to_c_struct(),
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"upload_geofence failed: {result}")

        return result

    def upload_rally_points_async(
        self, mission_items, callback: Callable, user_data: Any = None
    ):
        """Upload a list of rally point items to the system."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in upload_rally_points callback: {e}")

        cb = UploadRallyPointsCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_upload_rally_points_async(
            self._handle, mission_items, cb, None
        )

    def upload_rally_points(self, mission_items):
        """Get upload_rally_points (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_upload_rally_points(
            self._handle,
            mission_items.to_c_struct(),
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"upload_rally_points failed: {result}")

        return result

    def cancel_mission_upload(self):
        """Get cancel_mission_upload (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_cancel_mission_upload(
            self._handle,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"cancel_mission_upload failed: {result}")

        return result

    def download_mission_async(self, callback: Callable, user_data: Any = None):
        """Download a list of raw mission items from the system (asynchronous)."""

        def c_callback(result, c_data, size, ud):
            try:
                py_result = MissionRawResult(result)

                py_data = []
                if c_data and size.value > 0:
                    for i in range(size.value):
                        py_data.append(MissionItem.from_c_struct(c_data[i]))

                self._lib.mavsdk_mission_raw_mission_item_destroy(c_data)

                callback(py_result, py_data, user_data)

            except Exception as e:
                print(f"Error in download_mission callback: {e}")

        cb = DownloadMissionCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_download_mission_async(self._handle, cb, None)

    def download_mission(self):
        """Get download_mission (blocking)"""

        result_ptr = ctypes.POINTER(MissionItemCStruct)()
        size = ctypes.c_size_t()

        result_code = self._lib.mavsdk_mission_raw_download_mission(
            self._handle, ctypes.byref(result_ptr), ctypes.byref(size)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"download_mission failed: {result}")

        py_result = [
            MissionItem.from_c_struct(result_ptr[i]) for i in range(size.value)
        ]
        self._lib.mavsdk_mission_raw_mission_item_destroy(result_ptr)
        return py_result

    def download_geofence_async(self, callback: Callable, user_data: Any = None):
        """Download a list of raw geofence items from the system (asynchronous)."""

        def c_callback(result, c_data, size, ud):
            try:
                py_result = MissionRawResult(result)

                py_data = []
                if c_data and size.value > 0:
                    for i in range(size.value):
                        py_data.append(MissionItem.from_c_struct(c_data[i]))

                self._lib.mavsdk_mission_raw_mission_item_destroy(c_data)

                callback(py_result, py_data, user_data)

            except Exception as e:
                print(f"Error in download_geofence callback: {e}")

        cb = DownloadGeofenceCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_download_geofence_async(self._handle, cb, None)

    def download_geofence(self):
        """Get download_geofence (blocking)"""

        result_ptr = ctypes.POINTER(MissionItemCStruct)()
        size = ctypes.c_size_t()

        result_code = self._lib.mavsdk_mission_raw_download_geofence(
            self._handle, ctypes.byref(result_ptr), ctypes.byref(size)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"download_geofence failed: {result}")

        py_result = [
            MissionItem.from_c_struct(result_ptr[i]) for i in range(size.value)
        ]
        self._lib.mavsdk_mission_raw_mission_item_destroy(result_ptr)
        return py_result

    def download_rallypoints_async(self, callback: Callable, user_data: Any = None):
        """Download a list of raw rallypoint items from the system (asynchronous)."""

        def c_callback(result, c_data, size, ud):
            try:
                py_result = MissionRawResult(result)

                py_data = []
                if c_data and size.value > 0:
                    for i in range(size.value):
                        py_data.append(MissionItem.from_c_struct(c_data[i]))

                self._lib.mavsdk_mission_raw_mission_item_destroy(c_data)

                callback(py_result, py_data, user_data)

            except Exception as e:
                print(f"Error in download_rallypoints callback: {e}")

        cb = DownloadRallypointsCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_download_rallypoints_async(self._handle, cb, None)

    def download_rallypoints(self):
        """Get download_rallypoints (blocking)"""

        result_ptr = ctypes.POINTER(MissionItemCStruct)()
        size = ctypes.c_size_t()

        result_code = self._lib.mavsdk_mission_raw_download_rallypoints(
            self._handle, ctypes.byref(result_ptr), ctypes.byref(size)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"download_rallypoints failed: {result}")

        py_result = [
            MissionItem.from_c_struct(result_ptr[i]) for i in range(size.value)
        ]
        self._lib.mavsdk_mission_raw_mission_item_destroy(result_ptr)
        return py_result

    def cancel_mission_download(self):
        """Get cancel_mission_download (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_cancel_mission_download(
            self._handle,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"cancel_mission_download failed: {result}")

        return result

    def start_mission_async(self, callback: Callable, user_data: Any = None):
        """Start the mission.

        A mission must be uploaded to the vehicle before this can be called."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in start_mission callback: {e}")

        cb = StartMissionCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_start_mission_async(self._handle, cb, None)

    def start_mission(self):
        """Get start_mission (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_start_mission(
            self._handle,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"start_mission failed: {result}")

        return result

    def pause_mission_async(self, callback: Callable, user_data: Any = None):
        """Pause the mission.

        Pausing the mission puts the vehicle into
        [HOLD mode](https://docs.px4.io/en/flight_modes/hold.html).
        A multicopter should just hover at the spot while a fixedwing vehicle should loiter
        around the location where it paused."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in pause_mission callback: {e}")

        cb = PauseMissionCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_pause_mission_async(self._handle, cb, None)

    def pause_mission(self):
        """Get pause_mission (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_pause_mission(
            self._handle,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"pause_mission failed: {result}")

        return result

    def clear_mission_async(self, callback: Callable, user_data: Any = None):
        """Clear the mission saved on the vehicle."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in clear_mission callback: {e}")

        cb = ClearMissionCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_clear_mission_async(self._handle, cb, None)

    def clear_mission(self):
        """Get clear_mission (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_clear_mission(
            self._handle,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"clear_mission failed: {result}")

        return result

    def set_current_mission_item_async(
        self, index, callback: Callable, user_data: Any = None
    ):
        """Sets the raw mission item index to go to.

        By setting the current index to 0, the mission is restarted from the beginning. If it is set
        to a specific index of a raw mission item, the mission will be set to this item."""

        def c_callback(result, ud):
            try:
                py_result = MissionRawResult(result)

                callback(py_result, user_data)

            except Exception as e:
                print(f"Error in set_current_mission_item callback: {e}")

        cb = SetCurrentMissionItemCallback(c_callback)
        self._callbacks.append(cb)

        self._lib.mavsdk_mission_raw_set_current_mission_item_async(
            self._handle, index, cb, None
        )

    def set_current_mission_item(self, index):
        """Get set_current_mission_item (blocking)"""

        result_code = self._lib.mavsdk_mission_raw_set_current_mission_item(
            self._handle,
            index,
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"set_current_mission_item failed: {result}")

        return result

    def subscribe_mission_progress(self, callback: Callable, user_data: Any = None):
        """Subscribe to mission progress updates."""

        def c_callback(c_data, ud):
            try:
                py_data = MissionProgress.from_c_struct(c_data)

                self._lib.mavsdk_mission_raw_mission_progress_destroy(
                    ctypes.byref(c_data)
                )

                callback(py_data, user_data)

            except Exception as e:
                print(f"Error in mission_progress callback: {e}")

        cb = MissionProgressCallback(c_callback)
        self._callbacks.append(cb)

        return self._lib.mavsdk_mission_raw_subscribe_mission_progress(
            self._handle, cb, None
        )

    def unsubscribe_mission_progress(self, handle: ctypes.c_void_p):
        """Unsubscribe from mission_progress"""
        self._lib.mavsdk_mission_raw_unsubscribe_mission_progress(self._handle, handle)

    def mission_progress(self):
        """Get mission_progress (blocking)"""

        result_out = MissionProgressCStruct()

        self._lib.mavsdk_mission_raw_mission_progress(
            self._handle, ctypes.byref(result_out)
        )

        py_result = MissionProgress.from_c_struct(result_out)
        self._lib.mavsdk_mission_raw_mission_progress_destroy(ctypes.byref(result_out))
        return py_result

    def subscribe_mission_changed(self, callback: Callable, user_data: Any = None):
        """Subscribes to mission changed.

        This notification can be used to be informed if a ground station has
        been uploaded or changed by a ground station or companion computer.

        @param callback Callback to notify about change."""

        def c_callback(c_data, ud):
            try:
                py_data = c_data

                callback(py_data, user_data)

            except Exception as e:
                print(f"Error in mission_changed callback: {e}")

        cb = MissionChangedCallback(c_callback)
        self._callbacks.append(cb)

        return self._lib.mavsdk_mission_raw_subscribe_mission_changed(
            self._handle, cb, None
        )

    def unsubscribe_mission_changed(self, handle: ctypes.c_void_p):
        """Unsubscribe from mission_changed"""
        self._lib.mavsdk_mission_raw_unsubscribe_mission_changed(self._handle, handle)

    def import_qgroundcontrol_mission(self, qgc_plan_path):
        """Get import_qgroundcontrol_mission (blocking)"""

        result_out = MissionImportDataCStruct()

        result_code = self._lib.mavsdk_mission_raw_import_qgroundcontrol_mission(
            self._handle, qgc_plan_path, ctypes.byref(result_out)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"import_qgroundcontrol_mission failed: {result}")

        py_result = MissionImportData.from_c_struct(result_out)
        self._lib.mavsdk_mission_raw_mission_import_data_destroy(
            ctypes.byref(result_out)
        )
        return py_result

    def import_qgroundcontrol_mission_from_string(self, qgc_plan):
        """Get import_qgroundcontrol_mission_from_string (blocking)"""

        result_out = MissionImportDataCStruct()

        result_code = (
            self._lib.mavsdk_mission_raw_import_qgroundcontrol_mission_from_string(
                self._handle, qgc_plan, ctypes.byref(result_out)
            )
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(
                f"import_qgroundcontrol_mission_from_string failed: {result}"
            )

        py_result = MissionImportData.from_c_struct(result_out)
        self._lib.mavsdk_mission_raw_mission_import_data_destroy(
            ctypes.byref(result_out)
        )
        return py_result

    def import_mission_planner_mission(self, mission_planner_path):
        """Get import_mission_planner_mission (blocking)"""

        result_out = MissionImportDataCStruct()

        result_code = self._lib.mavsdk_mission_raw_import_mission_planner_mission(
            self._handle, mission_planner_path, ctypes.byref(result_out)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"import_mission_planner_mission failed: {result}")

        py_result = MissionImportData.from_c_struct(result_out)
        self._lib.mavsdk_mission_raw_mission_import_data_destroy(
            ctypes.byref(result_out)
        )
        return py_result

    def import_mission_planner_mission_from_string(self, mission_planner_mission):
        """Get import_mission_planner_mission_from_string (blocking)"""

        result_out = MissionImportDataCStruct()

        result_code = (
            self._lib.mavsdk_mission_raw_import_mission_planner_mission_from_string(
                self._handle, mission_planner_mission, ctypes.byref(result_out)
            )
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(
                f"import_mission_planner_mission_from_string failed: {result}"
            )

        py_result = MissionImportData.from_c_struct(result_out)
        self._lib.mavsdk_mission_raw_mission_import_data_destroy(
            ctypes.byref(result_out)
        )
        return py_result

    def is_mission_finished(self):
        """Get is_mission_finished (blocking)"""

        result_out = ctypes.c_bool()

        result_code = self._lib.mavsdk_mission_raw_is_mission_finished(
            self._handle, ctypes.byref(result_out)
        )
        result = MissionRawResult(result_code)
        if result != MissionRawResult.SUCCESS:
            raise Exception(f"is_mission_finished failed: {result}")

        return result_out.value

    def destroy(self):
        """Destroy the plugin instance"""
        if self._handle:
            self._lib.mavsdk_mission_raw_destroy(self._handle)
            self._handle = None

    def __del__(self):
        self.destroy()


# ===== Callback Types =====
UploadMissionCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
UploadGeofenceCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
UploadRallyPointsCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
DownloadMissionCallback = ctypes.CFUNCTYPE(
    None,
    ctypes.c_int,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    ctypes.c_void_p,
)
DownloadGeofenceCallback = ctypes.CFUNCTYPE(
    None,
    ctypes.c_int,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    ctypes.c_void_p,
)
DownloadRallypointsCallback = ctypes.CFUNCTYPE(
    None,
    ctypes.c_int,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    ctypes.c_void_p,
)
StartMissionCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
PauseMissionCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
ClearMissionCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
SetCurrentMissionItemCallback = ctypes.CFUNCTYPE(None, ctypes.c_int, ctypes.c_void_p)
MissionProgressCallback = ctypes.CFUNCTYPE(
    None, MissionProgressCStruct, ctypes.c_void_p
)
MissionChangedCallback = ctypes.CFUNCTYPE(None, ctypes.c_bool, ctypes.c_void_p)

# ===== Setup Functions =====
_cmavsdk_lib.mavsdk_mission_raw_create.argtypes = [ctypes.c_void_p]
_cmavsdk_lib.mavsdk_mission_raw_create.restype = ctypes.c_void_p

_cmavsdk_lib.mavsdk_mission_raw_destroy.argtypes = [ctypes.c_void_p]
_cmavsdk_lib.mavsdk_mission_raw_destroy.restype = None

_cmavsdk_lib.mavsdk_mission_raw_mission_progress_destroy.argtypes = [
    ctypes.POINTER(MissionProgressCStruct)
]
_cmavsdk_lib.mavsdk_mission_raw_mission_progress_destroy.restype = None

_cmavsdk_lib.mavsdk_mission_raw_mission_item_destroy.argtypes = [
    ctypes.POINTER(MissionItemCStruct)
]
_cmavsdk_lib.mavsdk_mission_raw_mission_item_destroy.restype = None

_cmavsdk_lib.mavsdk_mission_raw_mission_import_data_destroy.argtypes = [
    ctypes.POINTER(MissionImportDataCStruct)
]
_cmavsdk_lib.mavsdk_mission_raw_mission_import_data_destroy.restype = None


_cmavsdk_lib.mavsdk_mission_raw_upload_mission_async.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    UploadMissionCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_mission_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_upload_mission.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_mission.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_upload_geofence_async.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    UploadGeofenceCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_geofence_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_upload_geofence.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_geofence.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_upload_rally_points_async.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
    UploadRallyPointsCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_rally_points_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_upload_rally_points.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionItemCStruct),
    ctypes.c_size_t,
]

_cmavsdk_lib.mavsdk_mission_raw_upload_rally_points.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_mission_raw_cancel_mission_upload.argtypes = [
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_cancel_mission_upload.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_download_mission_async.argtypes = [
    ctypes.c_void_p,
    DownloadMissionCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_download_mission_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_download_mission.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(ctypes.POINTER(MissionItemCStruct)),
    ctypes.POINTER(ctypes.c_size_t),
]

_cmavsdk_lib.mavsdk_mission_raw_download_mission.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_download_geofence_async.argtypes = [
    ctypes.c_void_p,
    DownloadGeofenceCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_download_geofence_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_download_geofence.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(ctypes.POINTER(MissionItemCStruct)),
    ctypes.POINTER(ctypes.c_size_t),
]

_cmavsdk_lib.mavsdk_mission_raw_download_geofence.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_download_rallypoints_async.argtypes = [
    ctypes.c_void_p,
    DownloadRallypointsCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_download_rallypoints_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_download_rallypoints.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(ctypes.POINTER(MissionItemCStruct)),
    ctypes.POINTER(ctypes.c_size_t),
]

_cmavsdk_lib.mavsdk_mission_raw_download_rallypoints.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_mission_raw_cancel_mission_download.argtypes = [
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_cancel_mission_download.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_start_mission_async.argtypes = [
    ctypes.c_void_p,
    StartMissionCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_start_mission_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_start_mission.argtypes = [
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_start_mission.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_pause_mission_async.argtypes = [
    ctypes.c_void_p,
    PauseMissionCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_pause_mission_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_pause_mission.argtypes = [
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_pause_mission.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_clear_mission_async.argtypes = [
    ctypes.c_void_p,
    ClearMissionCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_clear_mission_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_clear_mission.argtypes = [
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_clear_mission.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_set_current_mission_item_async.argtypes = [
    ctypes.c_void_p,
    ctypes.c_int32,
    SetCurrentMissionItemCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_set_current_mission_item_async.restype = None

_cmavsdk_lib.mavsdk_mission_raw_set_current_mission_item.argtypes = [
    ctypes.c_void_p,
    ctypes.c_int32,
]

_cmavsdk_lib.mavsdk_mission_raw_set_current_mission_item.restype = ctypes.c_int
_cmavsdk_lib.mavsdk_mission_raw_subscribe_mission_progress.argtypes = [
    ctypes.c_void_p,
    MissionProgressCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_subscribe_mission_progress.restype = ctypes.c_void_p
# Unsubscribe
_cmavsdk_lib.mavsdk_mission_raw_unsubscribe_mission_progress.argtypes = [
    ctypes.c_void_p,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_unsubscribe_mission_progress.restype = None

_cmavsdk_lib.mavsdk_mission_raw_mission_progress.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(MissionProgressCStruct),
]

_cmavsdk_lib.mavsdk_mission_raw_mission_progress.restype = None
_cmavsdk_lib.mavsdk_mission_raw_subscribe_mission_changed.argtypes = [
    ctypes.c_void_p,
    MissionChangedCallback,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_subscribe_mission_changed.restype = ctypes.c_void_p
# Unsubscribe
_cmavsdk_lib.mavsdk_mission_raw_unsubscribe_mission_changed.argtypes = [
    ctypes.c_void_p,
    ctypes.c_void_p,
]

_cmavsdk_lib.mavsdk_mission_raw_unsubscribe_mission_changed.restype = None


_cmavsdk_lib.mavsdk_mission_raw_import_qgroundcontrol_mission.argtypes = [
    ctypes.c_void_p,
    ctypes.c_char_p,
    ctypes.POINTER(MissionImportDataCStruct),
]

_cmavsdk_lib.mavsdk_mission_raw_import_qgroundcontrol_mission.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_mission_raw_import_qgroundcontrol_mission_from_string.argtypes = [
    ctypes.c_void_p,
    ctypes.c_char_p,
    ctypes.POINTER(MissionImportDataCStruct),
]

_cmavsdk_lib.mavsdk_mission_raw_import_qgroundcontrol_mission_from_string.restype = (
    ctypes.c_int
)

_cmavsdk_lib.mavsdk_mission_raw_import_mission_planner_mission.argtypes = [
    ctypes.c_void_p,
    ctypes.c_char_p,
    ctypes.POINTER(MissionImportDataCStruct),
]

_cmavsdk_lib.mavsdk_mission_raw_import_mission_planner_mission.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_mission_raw_import_mission_planner_mission_from_string.argtypes = [
    ctypes.c_void_p,
    ctypes.c_char_p,
    ctypes.POINTER(MissionImportDataCStruct),
]

_cmavsdk_lib.mavsdk_mission_raw_import_mission_planner_mission_from_string.restype = (
    ctypes.c_int
)

_cmavsdk_lib.mavsdk_mission_raw_is_mission_finished.argtypes = [
    ctypes.c_void_p,
    ctypes.POINTER(ctypes.c_bool),
]

_cmavsdk_lib.mavsdk_mission_raw_is_mission_finished.restype = ctypes.c_int
