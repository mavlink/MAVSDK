# ruff: noqa: F401

# WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
# Edits need to be made to the proto files
# (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/telemetry_server/telemetry_server.proto)

"""
Allow users to provide vehicle telemetry and state information
 (e.g. battery, GPS, RC connection, flight mode etc.) and set telemetry update rates.
"""

import ctypes

from typing import Callable, Any
from enum import IntEnum

from ...cmavsdk_loader import _cmavsdk_lib


# ===== Enums =====
class FixType(IntEnum):
    """GPS fix type."""

    NO_GPS = 0
    NO_FIX = 1
    FIX_2D = 2
    FIX_3D = 3
    FIX_DGPS = 4
    RTK_FLOAT = 5
    RTK_FIXED = 6


class VtolState(IntEnum):
    """Maps to MAV_VTOL_STATE"""

    UNDEFINED = 0
    TRANSITION_TO_FW = 1
    TRANSITION_TO_MC = 2
    MC = 3
    FW = 4


class StatusTextType(IntEnum):
    """Status types."""

    DEBUG = 0
    INFO = 1
    NOTICE = 2
    WARNING = 3
    ERROR = 4
    CRITICAL = 5
    ALERT = 6
    EMERGENCY = 7


class LandedState(IntEnum):
    """Landed State enumeration."""

    UNKNOWN = 0
    ON_GROUND = 1
    IN_AIR = 2
    TAKING_OFF = 3
    LANDING = 4


# ===== Result Enums =====
class TelemetryServerResult(IntEnum):
    """Possible results returned for telemetry requests."""

    UNKNOWN = 0
    SUCCESS = 1
    NO_SYSTEM = 2
    CONNECTION_ERROR = 3
    BUSY = 4
    COMMAND_DENIED = 5
    TIMEOUT = 6
    UNSUPPORTED = 7


# ===== Internal C Structures =====
class PositionCStruct(ctypes.Structure):
    """
    Internal C structure for Position.
    Used only for C library communication.
    """

    _fields_ = [
        ("latitude_deg", ctypes.c_double),
        ("longitude_deg", ctypes.c_double),
        ("absolute_altitude_m", ctypes.c_float),
        ("relative_altitude_m", ctypes.c_float),
    ]


class HeadingCStruct(ctypes.Structure):
    """
    Internal C structure for Heading.
    Used only for C library communication.
    """

    _fields_ = [
        ("heading_deg", ctypes.c_double),
    ]


class QuaternionCStruct(ctypes.Structure):
    """
    Internal C structure for Quaternion.
    Used only for C library communication.
    """

    _fields_ = [
        ("w", ctypes.c_float),
        ("x", ctypes.c_float),
        ("y", ctypes.c_float),
        ("z", ctypes.c_float),
        ("timestamp_us", ctypes.c_uint64),
    ]


class EulerAngleCStruct(ctypes.Structure):
    """
    Internal C structure for EulerAngle.
    Used only for C library communication.
    """

    _fields_ = [
        ("roll_deg", ctypes.c_float),
        ("pitch_deg", ctypes.c_float),
        ("yaw_deg", ctypes.c_float),
        ("timestamp_us", ctypes.c_uint64),
    ]


class AngularVelocityBodyCStruct(ctypes.Structure):
    """
    Internal C structure for AngularVelocityBody.
    Used only for C library communication.
    """

    _fields_ = [
        ("roll_rad_s", ctypes.c_float),
        ("pitch_rad_s", ctypes.c_float),
        ("yaw_rad_s", ctypes.c_float),
    ]


class GpsInfoCStruct(ctypes.Structure):
    """
    Internal C structure for GpsInfo.
    Used only for C library communication.
    """

    _fields_ = [
        ("num_satellites", ctypes.c_int32),
        ("fix_type", ctypes.c_int),
    ]


class RawGpsCStruct(ctypes.Structure):
    """
    Internal C structure for RawGps.
    Used only for C library communication.
    """

    _fields_ = [
        ("timestamp_us", ctypes.c_uint64),
        ("latitude_deg", ctypes.c_double),
        ("longitude_deg", ctypes.c_double),
        ("absolute_altitude_m", ctypes.c_float),
        ("hdop", ctypes.c_float),
        ("vdop", ctypes.c_float),
        ("velocity_m_s", ctypes.c_float),
        ("cog_deg", ctypes.c_float),
        ("altitude_ellipsoid_m", ctypes.c_float),
        ("horizontal_uncertainty_m", ctypes.c_float),
        ("vertical_uncertainty_m", ctypes.c_float),
        ("velocity_uncertainty_m_s", ctypes.c_float),
        ("heading_uncertainty_deg", ctypes.c_float),
        ("yaw_deg", ctypes.c_float),
    ]


class BatteryCStruct(ctypes.Structure):
    """
    Internal C structure for Battery.
    Used only for C library communication.
    """

    _fields_ = [
        ("voltage_v", ctypes.c_float),
        ("remaining_percent", ctypes.c_float),
    ]


class RcStatusCStruct(ctypes.Structure):
    """
    Internal C structure for RcStatus.
    Used only for C library communication.
    """

    _fields_ = [
        ("was_available_once", ctypes.c_bool),
        ("is_available", ctypes.c_bool),
        ("signal_strength_percent", ctypes.c_float),
    ]


class StatusTextCStruct(ctypes.Structure):
    """
    Internal C structure for StatusText.
    Used only for C library communication.
    """

    _fields_ = [
        ("type", ctypes.c_int),
        ("text", ctypes.c_char_p),
    ]


class ActuatorControlTargetCStruct(ctypes.Structure):
    """
    Internal C structure for ActuatorControlTarget.
    Used only for C library communication.
    """

    _fields_ = [
        ("group", ctypes.c_int32),
        ("controls", ctypes.POINTER(ctypes.c_float)),
        ("controls_size", ctypes.c_size_t),
    ]


class ActuatorOutputStatusCStruct(ctypes.Structure):
    """
    Internal C structure for ActuatorOutputStatus.
    Used only for C library communication.
    """

    _fields_ = [
        ("active", ctypes.c_uint32),
        ("actuator", ctypes.POINTER(ctypes.c_float)),
        ("actuator_size", ctypes.c_size_t),
    ]


class CovarianceCStruct(ctypes.Structure):
    """
    Internal C structure for Covariance.
    Used only for C library communication.
    """

    _fields_ = [
        ("covariance_matrix", ctypes.POINTER(ctypes.c_float)),
        ("covariance_matrix_size", ctypes.c_size_t),
    ]


class VelocityBodyCStruct(ctypes.Structure):
    """
    Internal C structure for VelocityBody.
    Used only for C library communication.
    """

    _fields_ = [
        ("x_m_s", ctypes.c_float),
        ("y_m_s", ctypes.c_float),
        ("z_m_s", ctypes.c_float),
    ]


class PositionBodyCStruct(ctypes.Structure):
    """
    Internal C structure for PositionBody.
    Used only for C library communication.
    """

    _fields_ = [
        ("x_m", ctypes.c_float),
        ("y_m", ctypes.c_float),
        ("z_m", ctypes.c_float),
    ]


class OdometryCStruct(ctypes.Structure):
    """
    Internal C structure for Odometry.
    Used only for C library communication.
    """

    _fields_ = [
        ("time_usec", ctypes.c_uint64),
        ("frame_id", ctypes.c_int),
        ("child_frame_id", ctypes.c_int),
        ("position_body", PositionBodyCStruct),
        ("q", QuaternionCStruct),
        ("velocity_body", VelocityBodyCStruct),
        ("angular_velocity_body", AngularVelocityBodyCStruct),
        ("pose_covariance", CovarianceCStruct),
        ("velocity_covariance", CovarianceCStruct),
    ]


class DistanceSensorCStruct(ctypes.Structure):
    """
    Internal C structure for DistanceSensor.
    Used only for C library communication.
    """

    _fields_ = [
        ("minimum_distance_m", ctypes.c_float),
        ("maximum_distance_m", ctypes.c_float),
        ("current_distance_m", ctypes.c_float),
    ]


class ScaledPressureCStruct(ctypes.Structure):
    """
    Internal C structure for ScaledPressure.
    Used only for C library communication.
    """

    _fields_ = [
        ("timestamp_us", ctypes.c_uint64),
        ("absolute_pressure_hpa", ctypes.c_float),
        ("differential_pressure_hpa", ctypes.c_float),
        ("temperature_deg", ctypes.c_float),
        ("differential_pressure_temperature_deg", ctypes.c_float),
    ]


class PositionNedCStruct(ctypes.Structure):
    """
    Internal C structure for PositionNed.
    Used only for C library communication.
    """

    _fields_ = [
        ("north_m", ctypes.c_float),
        ("east_m", ctypes.c_float),
        ("down_m", ctypes.c_float),
    ]


class VelocityNedCStruct(ctypes.Structure):
    """
    Internal C structure for VelocityNed.
    Used only for C library communication.
    """

    _fields_ = [
        ("north_m_s", ctypes.c_float),
        ("east_m_s", ctypes.c_float),
        ("down_m_s", ctypes.c_float),
    ]


class PositionVelocityNedCStruct(ctypes.Structure):
    """
    Internal C structure for PositionVelocityNed.
    Used only for C library communication.
    """

    _fields_ = [
        ("position", PositionNedCStruct),
        ("velocity", VelocityNedCStruct),
    ]


class GroundTruthCStruct(ctypes.Structure):
    """
    Internal C structure for GroundTruth.
    Used only for C library communication.
    """

    _fields_ = [
        ("latitude_deg", ctypes.c_double),
        ("longitude_deg", ctypes.c_double),
        ("absolute_altitude_m", ctypes.c_float),
    ]


class FixedwingMetricsCStruct(ctypes.Structure):
    """
    Internal C structure for FixedwingMetrics.
    Used only for C library communication.
    """

    _fields_ = [
        ("airspeed_m_s", ctypes.c_float),
        ("throttle_percentage", ctypes.c_float),
        ("climb_rate_m_s", ctypes.c_float),
        ("groundspeed_m_s", ctypes.c_float),
        ("heading_deg", ctypes.c_float),
        ("absolute_altitude_m", ctypes.c_float),
    ]


class AccelerationFrdCStruct(ctypes.Structure):
    """
    Internal C structure for AccelerationFrd.
    Used only for C library communication.
    """

    _fields_ = [
        ("forward_m_s2", ctypes.c_float),
        ("right_m_s2", ctypes.c_float),
        ("down_m_s2", ctypes.c_float),
    ]


class AngularVelocityFrdCStruct(ctypes.Structure):
    """
    Internal C structure for AngularVelocityFrd.
    Used only for C library communication.
    """

    _fields_ = [
        ("forward_rad_s", ctypes.c_float),
        ("right_rad_s", ctypes.c_float),
        ("down_rad_s", ctypes.c_float),
    ]


class MagneticFieldFrdCStruct(ctypes.Structure):
    """
    Internal C structure for MagneticFieldFrd.
    Used only for C library communication.
    """

    _fields_ = [
        ("forward_gauss", ctypes.c_float),
        ("right_gauss", ctypes.c_float),
        ("down_gauss", ctypes.c_float),
    ]


class ImuCStruct(ctypes.Structure):
    """
    Internal C structure for Imu.
    Used only for C library communication.
    """

    _fields_ = [
        ("acceleration_frd", AccelerationFrdCStruct),
        ("angular_velocity_frd", AngularVelocityFrdCStruct),
        ("magnetic_field_frd", MagneticFieldFrdCStruct),
        ("temperature_degc", ctypes.c_float),
        ("timestamp_us", ctypes.c_uint64),
    ]


# ===== Structures =====
class Position:
    """
    Position type in global coordinates.
    """

    def __init__(
        self,
        latitude_deg=None,
        longitude_deg=None,
        absolute_altitude_m=None,
        relative_altitude_m=None,
    ):
        self.latitude_deg = latitude_deg
        self.longitude_deg = longitude_deg
        self.absolute_altitude_m = absolute_altitude_m
        self.relative_altitude_m = relative_altitude_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.latitude_deg = c_struct.latitude_deg
        instance.longitude_deg = c_struct.longitude_deg
        instance.absolute_altitude_m = c_struct.absolute_altitude_m
        instance.relative_altitude_m = c_struct.relative_altitude_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = PositionCStruct()
        c_struct.latitude_deg = self.latitude_deg
        c_struct.longitude_deg = self.longitude_deg
        c_struct.absolute_altitude_m = self.absolute_altitude_m
        c_struct.relative_altitude_m = self.relative_altitude_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"latitude_deg={self.latitude_deg}")
        fields.append(f"longitude_deg={self.longitude_deg}")
        fields.append(f"absolute_altitude_m={self.absolute_altitude_m}")
        fields.append(f"relative_altitude_m={self.relative_altitude_m}")
        return f"Position({', '.join(fields)})"


class Heading:
    """
    Heading type used for global position
    """

    def __init__(self, heading_deg=None):
        self.heading_deg = heading_deg

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.heading_deg = c_struct.heading_deg
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = HeadingCStruct()
        c_struct.heading_deg = self.heading_deg
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"heading_deg={self.heading_deg}")
        return f"Heading({', '.join(fields)})"


class Quaternion:
    """
       Quaternion type.

    All rotations and axis systems follow the right-hand rule.
    The Hamilton quaternion product definition is used.
    A zero-rotation quaternion is represented by (1,0,0,0).
    The quaternion could also be written as w + xi + yj + zk.

    For more info see: https://en.wikipedia.org/wiki/Quaternion
    """

    def __init__(self, w=None, x=None, y=None, z=None, timestamp_us=None):
        self.w = w
        self.x = x
        self.y = y
        self.z = z
        self.timestamp_us = timestamp_us

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.w = c_struct.w
        instance.x = c_struct.x
        instance.y = c_struct.y
        instance.z = c_struct.z
        instance.timestamp_us = c_struct.timestamp_us
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = QuaternionCStruct()
        c_struct.w = self.w
        c_struct.x = self.x
        c_struct.y = self.y
        c_struct.z = self.z
        c_struct.timestamp_us = self.timestamp_us
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"w={self.w}")
        fields.append(f"x={self.x}")
        fields.append(f"y={self.y}")
        fields.append(f"z={self.z}")
        fields.append(f"timestamp_us={self.timestamp_us}")
        return f"Quaternion({', '.join(fields)})"


class EulerAngle:
    """
       Euler angle type.

    All rotations and axis systems follow the right-hand rule.
    The Euler angles follow the convention of a 3-2-1 intrinsic Tait-Bryan rotation sequence.

    For more info see https://en.wikipedia.org/wiki/Euler_angles
    """

    def __init__(self, roll_deg=None, pitch_deg=None, yaw_deg=None, timestamp_us=None):
        self.roll_deg = roll_deg
        self.pitch_deg = pitch_deg
        self.yaw_deg = yaw_deg
        self.timestamp_us = timestamp_us

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.roll_deg = c_struct.roll_deg
        instance.pitch_deg = c_struct.pitch_deg
        instance.yaw_deg = c_struct.yaw_deg
        instance.timestamp_us = c_struct.timestamp_us
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = EulerAngleCStruct()
        c_struct.roll_deg = self.roll_deg
        c_struct.pitch_deg = self.pitch_deg
        c_struct.yaw_deg = self.yaw_deg
        c_struct.timestamp_us = self.timestamp_us
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"roll_deg={self.roll_deg}")
        fields.append(f"pitch_deg={self.pitch_deg}")
        fields.append(f"yaw_deg={self.yaw_deg}")
        fields.append(f"timestamp_us={self.timestamp_us}")
        return f"EulerAngle({', '.join(fields)})"


class AngularVelocityBody:
    """
    Angular velocity type.
    """

    def __init__(self, roll_rad_s=None, pitch_rad_s=None, yaw_rad_s=None):
        self.roll_rad_s = roll_rad_s
        self.pitch_rad_s = pitch_rad_s
        self.yaw_rad_s = yaw_rad_s

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.roll_rad_s = c_struct.roll_rad_s
        instance.pitch_rad_s = c_struct.pitch_rad_s
        instance.yaw_rad_s = c_struct.yaw_rad_s
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = AngularVelocityBodyCStruct()
        c_struct.roll_rad_s = self.roll_rad_s
        c_struct.pitch_rad_s = self.pitch_rad_s
        c_struct.yaw_rad_s = self.yaw_rad_s
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"roll_rad_s={self.roll_rad_s}")
        fields.append(f"pitch_rad_s={self.pitch_rad_s}")
        fields.append(f"yaw_rad_s={self.yaw_rad_s}")
        return f"AngularVelocityBody({', '.join(fields)})"


class GpsInfo:
    """
    GPS information type.
    """

    def __init__(self, num_satellites=None, fix_type=None):
        self.num_satellites = num_satellites
        self.fix_type = fix_type

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.num_satellites = c_struct.num_satellites
        instance.fix_type = FixType(c_struct.fix_type)
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = GpsInfoCStruct()
        c_struct.num_satellites = self.num_satellites
        c_struct.fix_type = int(self.fix_type)
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"num_satellites={self.num_satellites}")
        fields.append(f"fix_type={self.fix_type}")
        return f"GpsInfo({', '.join(fields)})"


class RawGps:
    """
       Raw GPS information type.

    Warning: this is an advanced type! If you want the location of the drone, use
    the position instead. This message exposes the raw values of the GNSS sensor.
    """

    def __init__(
        self,
        timestamp_us=None,
        latitude_deg=None,
        longitude_deg=None,
        absolute_altitude_m=None,
        hdop=None,
        vdop=None,
        velocity_m_s=None,
        cog_deg=None,
        altitude_ellipsoid_m=None,
        horizontal_uncertainty_m=None,
        vertical_uncertainty_m=None,
        velocity_uncertainty_m_s=None,
        heading_uncertainty_deg=None,
        yaw_deg=None,
    ):
        self.timestamp_us = timestamp_us
        self.latitude_deg = latitude_deg
        self.longitude_deg = longitude_deg
        self.absolute_altitude_m = absolute_altitude_m
        self.hdop = hdop
        self.vdop = vdop
        self.velocity_m_s = velocity_m_s
        self.cog_deg = cog_deg
        self.altitude_ellipsoid_m = altitude_ellipsoid_m
        self.horizontal_uncertainty_m = horizontal_uncertainty_m
        self.vertical_uncertainty_m = vertical_uncertainty_m
        self.velocity_uncertainty_m_s = velocity_uncertainty_m_s
        self.heading_uncertainty_deg = heading_uncertainty_deg
        self.yaw_deg = yaw_deg

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.timestamp_us = c_struct.timestamp_us
        instance.latitude_deg = c_struct.latitude_deg
        instance.longitude_deg = c_struct.longitude_deg
        instance.absolute_altitude_m = c_struct.absolute_altitude_m
        instance.hdop = c_struct.hdop
        instance.vdop = c_struct.vdop
        instance.velocity_m_s = c_struct.velocity_m_s
        instance.cog_deg = c_struct.cog_deg
        instance.altitude_ellipsoid_m = c_struct.altitude_ellipsoid_m
        instance.horizontal_uncertainty_m = c_struct.horizontal_uncertainty_m
        instance.vertical_uncertainty_m = c_struct.vertical_uncertainty_m
        instance.velocity_uncertainty_m_s = c_struct.velocity_uncertainty_m_s
        instance.heading_uncertainty_deg = c_struct.heading_uncertainty_deg
        instance.yaw_deg = c_struct.yaw_deg
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = RawGpsCStruct()
        c_struct.timestamp_us = self.timestamp_us
        c_struct.latitude_deg = self.latitude_deg
        c_struct.longitude_deg = self.longitude_deg
        c_struct.absolute_altitude_m = self.absolute_altitude_m
        c_struct.hdop = self.hdop
        c_struct.vdop = self.vdop
        c_struct.velocity_m_s = self.velocity_m_s
        c_struct.cog_deg = self.cog_deg
        c_struct.altitude_ellipsoid_m = self.altitude_ellipsoid_m
        c_struct.horizontal_uncertainty_m = self.horizontal_uncertainty_m
        c_struct.vertical_uncertainty_m = self.vertical_uncertainty_m
        c_struct.velocity_uncertainty_m_s = self.velocity_uncertainty_m_s
        c_struct.heading_uncertainty_deg = self.heading_uncertainty_deg
        c_struct.yaw_deg = self.yaw_deg
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"timestamp_us={self.timestamp_us}")
        fields.append(f"latitude_deg={self.latitude_deg}")
        fields.append(f"longitude_deg={self.longitude_deg}")
        fields.append(f"absolute_altitude_m={self.absolute_altitude_m}")
        fields.append(f"hdop={self.hdop}")
        fields.append(f"vdop={self.vdop}")
        fields.append(f"velocity_m_s={self.velocity_m_s}")
        fields.append(f"cog_deg={self.cog_deg}")
        fields.append(f"altitude_ellipsoid_m={self.altitude_ellipsoid_m}")
        fields.append(f"horizontal_uncertainty_m={self.horizontal_uncertainty_m}")
        fields.append(f"vertical_uncertainty_m={self.vertical_uncertainty_m}")
        fields.append(f"velocity_uncertainty_m_s={self.velocity_uncertainty_m_s}")
        fields.append(f"heading_uncertainty_deg={self.heading_uncertainty_deg}")
        fields.append(f"yaw_deg={self.yaw_deg}")
        return f"RawGps({', '.join(fields)})"


class Battery:
    """
    Battery type.
    """

    def __init__(self, voltage_v=None, remaining_percent=None):
        self.voltage_v = voltage_v
        self.remaining_percent = remaining_percent

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.voltage_v = c_struct.voltage_v
        instance.remaining_percent = c_struct.remaining_percent
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = BatteryCStruct()
        c_struct.voltage_v = self.voltage_v
        c_struct.remaining_percent = self.remaining_percent
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"voltage_v={self.voltage_v}")
        fields.append(f"remaining_percent={self.remaining_percent}")
        return f"Battery({', '.join(fields)})"


class RcStatus:
    """
    Remote control status type.
    """

    def __init__(
        self, was_available_once=None, is_available=None, signal_strength_percent=None
    ):
        self.was_available_once = was_available_once
        self.is_available = is_available
        self.signal_strength_percent = signal_strength_percent

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.was_available_once = c_struct.was_available_once
        instance.is_available = c_struct.is_available
        instance.signal_strength_percent = c_struct.signal_strength_percent
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = RcStatusCStruct()
        c_struct.was_available_once = self.was_available_once
        c_struct.is_available = self.is_available
        c_struct.signal_strength_percent = self.signal_strength_percent
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"was_available_once={self.was_available_once}")
        fields.append(f"is_available={self.is_available}")
        fields.append(f"signal_strength_percent={self.signal_strength_percent}")
        return f"RcStatus({', '.join(fields)})"


class StatusText:
    """
    StatusText information type.
    """

    def __init__(self, type=None, text=None):
        self.type = type
        self.text = text

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.type = StatusTextType(c_struct.type)
        instance.text = c_struct.text.decode("utf-8")
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = StatusTextCStruct()
        c_struct.type = int(self.type)
        c_struct.text = self.text.encode("utf-8")
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"type={self.type}")
        fields.append(f"text={self.text}")
        return f"StatusText({', '.join(fields)})"


class ActuatorControlTarget:
    """
    Actuator control target type.
    """

    def __init__(self, group=None, controls=None):
        self.group = group
        self.controls = controls or []

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.group = c_struct.group
        if c_struct.controls_size > 0:
            instance.controls = [
                c_struct.controls[i] for i in range(c_struct.controls_size)
            ]
        else:
            instance.controls = []
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = ActuatorControlTargetCStruct()
        c_struct.group = self.group
        array_type = ctypes.c_float * len(self.controls)
        c_struct.controls = array_type(*self.controls)
        c_struct.controls_size = len(self.controls)
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"group={self.group}")
        fields.append(f"controls=[{len(self.controls)} items]")
        return f"ActuatorControlTarget({', '.join(fields)})"


class ActuatorOutputStatus:
    """
    Actuator output status type.
    """

    def __init__(self, active=None, actuator=None):
        self.active = active
        self.actuator = actuator or []

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.active = c_struct.active
        if c_struct.actuator_size > 0:
            instance.actuator = [
                c_struct.actuator[i] for i in range(c_struct.actuator_size)
            ]
        else:
            instance.actuator = []
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = ActuatorOutputStatusCStruct()
        c_struct.active = self.active
        array_type = ctypes.c_float * len(self.actuator)
        c_struct.actuator = array_type(*self.actuator)
        c_struct.actuator_size = len(self.actuator)
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"active={self.active}")
        fields.append(f"actuator=[{len(self.actuator)} items]")
        return f"ActuatorOutputStatus({', '.join(fields)})"


class Covariance:
    """
       Covariance type.

    Row-major representation of a 6x6 cross-covariance matrix
    upper right triangle.
    Set first to NaN if unknown.
    """

    def __init__(self, covariance_matrix=None):
        self.covariance_matrix = covariance_matrix or []

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        if c_struct.covariance_matrix_size > 0:
            instance.covariance_matrix = [
                c_struct.covariance_matrix[i]
                for i in range(c_struct.covariance_matrix_size)
            ]
        else:
            instance.covariance_matrix = []
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = CovarianceCStruct()
        array_type = ctypes.c_float * len(self.covariance_matrix)
        c_struct.covariance_matrix = array_type(*self.covariance_matrix)
        c_struct.covariance_matrix_size = len(self.covariance_matrix)
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"covariance_matrix=[{len(self.covariance_matrix)} items]")
        return f"Covariance({', '.join(fields)})"


class VelocityBody:
    """
    Velocity type, represented in the Body (X Y Z) frame and in metres/second.
    """

    def __init__(self, x_m_s=None, y_m_s=None, z_m_s=None):
        self.x_m_s = x_m_s
        self.y_m_s = y_m_s
        self.z_m_s = z_m_s

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.x_m_s = c_struct.x_m_s
        instance.y_m_s = c_struct.y_m_s
        instance.z_m_s = c_struct.z_m_s
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = VelocityBodyCStruct()
        c_struct.x_m_s = self.x_m_s
        c_struct.y_m_s = self.y_m_s
        c_struct.z_m_s = self.z_m_s
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"x_m_s={self.x_m_s}")
        fields.append(f"y_m_s={self.y_m_s}")
        fields.append(f"z_m_s={self.z_m_s}")
        return f"VelocityBody({', '.join(fields)})"


class PositionBody:
    """
    Position type, represented in the Body (X Y Z) frame
    """

    def __init__(self, x_m=None, y_m=None, z_m=None):
        self.x_m = x_m
        self.y_m = y_m
        self.z_m = z_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.x_m = c_struct.x_m
        instance.y_m = c_struct.y_m
        instance.z_m = c_struct.z_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = PositionBodyCStruct()
        c_struct.x_m = self.x_m
        c_struct.y_m = self.y_m
        c_struct.z_m = self.z_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"x_m={self.x_m}")
        fields.append(f"y_m={self.y_m}")
        fields.append(f"z_m={self.z_m}")
        return f"PositionBody({', '.join(fields)})"


class Odometry:
    """
    Odometry message type.
    """

    class MavFrame(IntEnum):
        """Mavlink frame id"""

        UNDEF = 0
        BODY_NED = 1
        VISION_NED = 2
        ESTIM_NED = 3

    def __init__(
        self,
        time_usec=None,
        frame_id=None,
        child_frame_id=None,
        position_body=None,
        q=None,
        velocity_body=None,
        angular_velocity_body=None,
        pose_covariance=None,
        velocity_covariance=None,
    ):
        self.time_usec = time_usec
        self.frame_id = frame_id
        self.child_frame_id = child_frame_id
        self.position_body = position_body
        self.q = q
        self.velocity_body = velocity_body
        self.angular_velocity_body = angular_velocity_body
        self.pose_covariance = pose_covariance
        self.velocity_covariance = velocity_covariance

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.time_usec = c_struct.time_usec
        instance.frame_id = Odometry.MavFrame(c_struct.frame_id)
        instance.child_frame_id = Odometry.MavFrame(c_struct.child_frame_id)
        instance.position_body = PositionBody.from_c_struct(c_struct.position_body)
        instance.q = Quaternion.from_c_struct(c_struct.q)
        instance.velocity_body = VelocityBody.from_c_struct(c_struct.velocity_body)
        instance.angular_velocity_body = AngularVelocityBody.from_c_struct(
            c_struct.angular_velocity_body
        )
        instance.pose_covariance = Covariance.from_c_struct(c_struct.pose_covariance)
        instance.velocity_covariance = Covariance.from_c_struct(
            c_struct.velocity_covariance
        )
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = OdometryCStruct()
        c_struct.time_usec = self.time_usec
        c_struct.frame_id = int(self.frame_id)
        c_struct.child_frame_id = int(self.child_frame_id)
        c_struct.position_body = self.position_body.to_c_struct()
        c_struct.q = self.q.to_c_struct()
        c_struct.velocity_body = self.velocity_body.to_c_struct()
        c_struct.angular_velocity_body = self.angular_velocity_body.to_c_struct()
        c_struct.pose_covariance = self.pose_covariance.to_c_struct()
        c_struct.velocity_covariance = self.velocity_covariance.to_c_struct()
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"time_usec={self.time_usec}")
        fields.append(f"frame_id={self.frame_id}")
        fields.append(f"child_frame_id={self.child_frame_id}")
        fields.append(f"position_body={self.position_body}")
        fields.append(f"q={self.q}")
        fields.append(f"velocity_body={self.velocity_body}")
        fields.append(f"angular_velocity_body={self.angular_velocity_body}")
        fields.append(f"pose_covariance={self.pose_covariance}")
        fields.append(f"velocity_covariance={self.velocity_covariance}")
        return f"Odometry({', '.join(fields)})"


class DistanceSensor:
    """
    DistanceSensor message type.
    """

    def __init__(
        self, minimum_distance_m=None, maximum_distance_m=None, current_distance_m=None
    ):
        self.minimum_distance_m = minimum_distance_m
        self.maximum_distance_m = maximum_distance_m
        self.current_distance_m = current_distance_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.minimum_distance_m = c_struct.minimum_distance_m
        instance.maximum_distance_m = c_struct.maximum_distance_m
        instance.current_distance_m = c_struct.current_distance_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = DistanceSensorCStruct()
        c_struct.minimum_distance_m = self.minimum_distance_m
        c_struct.maximum_distance_m = self.maximum_distance_m
        c_struct.current_distance_m = self.current_distance_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"minimum_distance_m={self.minimum_distance_m}")
        fields.append(f"maximum_distance_m={self.maximum_distance_m}")
        fields.append(f"current_distance_m={self.current_distance_m}")
        return f"DistanceSensor({', '.join(fields)})"


class ScaledPressure:
    """
    Scaled Pressure message type.
    """

    def __init__(
        self,
        timestamp_us=None,
        absolute_pressure_hpa=None,
        differential_pressure_hpa=None,
        temperature_deg=None,
        differential_pressure_temperature_deg=None,
    ):
        self.timestamp_us = timestamp_us
        self.absolute_pressure_hpa = absolute_pressure_hpa
        self.differential_pressure_hpa = differential_pressure_hpa
        self.temperature_deg = temperature_deg
        self.differential_pressure_temperature_deg = (
            differential_pressure_temperature_deg
        )

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.timestamp_us = c_struct.timestamp_us
        instance.absolute_pressure_hpa = c_struct.absolute_pressure_hpa
        instance.differential_pressure_hpa = c_struct.differential_pressure_hpa
        instance.temperature_deg = c_struct.temperature_deg
        instance.differential_pressure_temperature_deg = (
            c_struct.differential_pressure_temperature_deg
        )
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = ScaledPressureCStruct()
        c_struct.timestamp_us = self.timestamp_us
        c_struct.absolute_pressure_hpa = self.absolute_pressure_hpa
        c_struct.differential_pressure_hpa = self.differential_pressure_hpa
        c_struct.temperature_deg = self.temperature_deg
        c_struct.differential_pressure_temperature_deg = (
            self.differential_pressure_temperature_deg
        )
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"timestamp_us={self.timestamp_us}")
        fields.append(f"absolute_pressure_hpa={self.absolute_pressure_hpa}")
        fields.append(f"differential_pressure_hpa={self.differential_pressure_hpa}")
        fields.append(f"temperature_deg={self.temperature_deg}")
        fields.append(
            f"differential_pressure_temperature_deg={self.differential_pressure_temperature_deg}"
        )
        return f"ScaledPressure({', '.join(fields)})"


class PositionNed:
    """
    PositionNed message type.
    """

    def __init__(self, north_m=None, east_m=None, down_m=None):
        self.north_m = north_m
        self.east_m = east_m
        self.down_m = down_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.north_m = c_struct.north_m
        instance.east_m = c_struct.east_m
        instance.down_m = c_struct.down_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = PositionNedCStruct()
        c_struct.north_m = self.north_m
        c_struct.east_m = self.east_m
        c_struct.down_m = self.down_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"north_m={self.north_m}")
        fields.append(f"east_m={self.east_m}")
        fields.append(f"down_m={self.down_m}")
        return f"PositionNed({', '.join(fields)})"


class VelocityNed:
    """
    VelocityNed message type.
    """

    def __init__(self, north_m_s=None, east_m_s=None, down_m_s=None):
        self.north_m_s = north_m_s
        self.east_m_s = east_m_s
        self.down_m_s = down_m_s

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.north_m_s = c_struct.north_m_s
        instance.east_m_s = c_struct.east_m_s
        instance.down_m_s = c_struct.down_m_s
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = VelocityNedCStruct()
        c_struct.north_m_s = self.north_m_s
        c_struct.east_m_s = self.east_m_s
        c_struct.down_m_s = self.down_m_s
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"north_m_s={self.north_m_s}")
        fields.append(f"east_m_s={self.east_m_s}")
        fields.append(f"down_m_s={self.down_m_s}")
        return f"VelocityNed({', '.join(fields)})"


class PositionVelocityNed:
    """
    PositionVelocityNed message type.
    """

    def __init__(self, position=None, velocity=None):
        self.position = position
        self.velocity = velocity

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.position = PositionNed.from_c_struct(c_struct.position)
        instance.velocity = VelocityNed.from_c_struct(c_struct.velocity)
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = PositionVelocityNedCStruct()
        c_struct.position = self.position.to_c_struct()
        c_struct.velocity = self.velocity.to_c_struct()
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"position={self.position}")
        fields.append(f"velocity={self.velocity}")
        return f"PositionVelocityNed({', '.join(fields)})"


class GroundTruth:
    """
    GroundTruth message type.
    """

    def __init__(self, latitude_deg=None, longitude_deg=None, absolute_altitude_m=None):
        self.latitude_deg = latitude_deg
        self.longitude_deg = longitude_deg
        self.absolute_altitude_m = absolute_altitude_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.latitude_deg = c_struct.latitude_deg
        instance.longitude_deg = c_struct.longitude_deg
        instance.absolute_altitude_m = c_struct.absolute_altitude_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = GroundTruthCStruct()
        c_struct.latitude_deg = self.latitude_deg
        c_struct.longitude_deg = self.longitude_deg
        c_struct.absolute_altitude_m = self.absolute_altitude_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"latitude_deg={self.latitude_deg}")
        fields.append(f"longitude_deg={self.longitude_deg}")
        fields.append(f"absolute_altitude_m={self.absolute_altitude_m}")
        return f"GroundTruth({', '.join(fields)})"


class FixedwingMetrics:
    """
    FixedwingMetrics message type.
    """

    def __init__(
        self,
        airspeed_m_s=None,
        throttle_percentage=None,
        climb_rate_m_s=None,
        groundspeed_m_s=None,
        heading_deg=None,
        absolute_altitude_m=None,
    ):
        self.airspeed_m_s = airspeed_m_s
        self.throttle_percentage = throttle_percentage
        self.climb_rate_m_s = climb_rate_m_s
        self.groundspeed_m_s = groundspeed_m_s
        self.heading_deg = heading_deg
        self.absolute_altitude_m = absolute_altitude_m

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.airspeed_m_s = c_struct.airspeed_m_s
        instance.throttle_percentage = c_struct.throttle_percentage
        instance.climb_rate_m_s = c_struct.climb_rate_m_s
        instance.groundspeed_m_s = c_struct.groundspeed_m_s
        instance.heading_deg = c_struct.heading_deg
        instance.absolute_altitude_m = c_struct.absolute_altitude_m
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = FixedwingMetricsCStruct()
        c_struct.airspeed_m_s = self.airspeed_m_s
        c_struct.throttle_percentage = self.throttle_percentage
        c_struct.climb_rate_m_s = self.climb_rate_m_s
        c_struct.groundspeed_m_s = self.groundspeed_m_s
        c_struct.heading_deg = self.heading_deg
        c_struct.absolute_altitude_m = self.absolute_altitude_m
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"airspeed_m_s={self.airspeed_m_s}")
        fields.append(f"throttle_percentage={self.throttle_percentage}")
        fields.append(f"climb_rate_m_s={self.climb_rate_m_s}")
        fields.append(f"groundspeed_m_s={self.groundspeed_m_s}")
        fields.append(f"heading_deg={self.heading_deg}")
        fields.append(f"absolute_altitude_m={self.absolute_altitude_m}")
        return f"FixedwingMetrics({', '.join(fields)})"


class AccelerationFrd:
    """
    AccelerationFrd message type.
    """

    def __init__(self, forward_m_s2=None, right_m_s2=None, down_m_s2=None):
        self.forward_m_s2 = forward_m_s2
        self.right_m_s2 = right_m_s2
        self.down_m_s2 = down_m_s2

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.forward_m_s2 = c_struct.forward_m_s2
        instance.right_m_s2 = c_struct.right_m_s2
        instance.down_m_s2 = c_struct.down_m_s2
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = AccelerationFrdCStruct()
        c_struct.forward_m_s2 = self.forward_m_s2
        c_struct.right_m_s2 = self.right_m_s2
        c_struct.down_m_s2 = self.down_m_s2
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"forward_m_s2={self.forward_m_s2}")
        fields.append(f"right_m_s2={self.right_m_s2}")
        fields.append(f"down_m_s2={self.down_m_s2}")
        return f"AccelerationFrd({', '.join(fields)})"


class AngularVelocityFrd:
    """
    AngularVelocityFrd message type.
    """

    def __init__(self, forward_rad_s=None, right_rad_s=None, down_rad_s=None):
        self.forward_rad_s = forward_rad_s
        self.right_rad_s = right_rad_s
        self.down_rad_s = down_rad_s

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.forward_rad_s = c_struct.forward_rad_s
        instance.right_rad_s = c_struct.right_rad_s
        instance.down_rad_s = c_struct.down_rad_s
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = AngularVelocityFrdCStruct()
        c_struct.forward_rad_s = self.forward_rad_s
        c_struct.right_rad_s = self.right_rad_s
        c_struct.down_rad_s = self.down_rad_s
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"forward_rad_s={self.forward_rad_s}")
        fields.append(f"right_rad_s={self.right_rad_s}")
        fields.append(f"down_rad_s={self.down_rad_s}")
        return f"AngularVelocityFrd({', '.join(fields)})"


class MagneticFieldFrd:
    """
    MagneticFieldFrd message type.
    """

    def __init__(self, forward_gauss=None, right_gauss=None, down_gauss=None):
        self.forward_gauss = forward_gauss
        self.right_gauss = right_gauss
        self.down_gauss = down_gauss

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.forward_gauss = c_struct.forward_gauss
        instance.right_gauss = c_struct.right_gauss
        instance.down_gauss = c_struct.down_gauss
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = MagneticFieldFrdCStruct()
        c_struct.forward_gauss = self.forward_gauss
        c_struct.right_gauss = self.right_gauss
        c_struct.down_gauss = self.down_gauss
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"forward_gauss={self.forward_gauss}")
        fields.append(f"right_gauss={self.right_gauss}")
        fields.append(f"down_gauss={self.down_gauss}")
        return f"MagneticFieldFrd({', '.join(fields)})"


class Imu:
    """
    Imu message type.
    """

    def __init__(
        self,
        acceleration_frd=None,
        angular_velocity_frd=None,
        magnetic_field_frd=None,
        temperature_degc=None,
        timestamp_us=None,
    ):
        self.acceleration_frd = acceleration_frd
        self.angular_velocity_frd = angular_velocity_frd
        self.magnetic_field_frd = magnetic_field_frd
        self.temperature_degc = temperature_degc
        self.timestamp_us = timestamp_us

    @classmethod
    def from_c_struct(cls, c_struct):
        """Convert from C structure to Python object"""
        instance = cls()
        instance.acceleration_frd = AccelerationFrd.from_c_struct(
            c_struct.acceleration_frd
        )
        instance.angular_velocity_frd = AngularVelocityFrd.from_c_struct(
            c_struct.angular_velocity_frd
        )
        instance.magnetic_field_frd = MagneticFieldFrd.from_c_struct(
            c_struct.magnetic_field_frd
        )
        instance.temperature_degc = c_struct.temperature_degc
        instance.timestamp_us = c_struct.timestamp_us
        return instance

    def to_c_struct(self):
        """Convert to C structure for C library calls"""
        c_struct = ImuCStruct()
        c_struct.acceleration_frd = self.acceleration_frd.to_c_struct()
        c_struct.angular_velocity_frd = self.angular_velocity_frd.to_c_struct()
        c_struct.magnetic_field_frd = self.magnetic_field_frd.to_c_struct()
        c_struct.temperature_degc = self.temperature_degc
        c_struct.timestamp_us = self.timestamp_us
        return c_struct

    def __str__(self):
        fields = []
        fields.append(f"acceleration_frd={self.acceleration_frd}")
        fields.append(f"angular_velocity_frd={self.angular_velocity_frd}")
        fields.append(f"magnetic_field_frd={self.magnetic_field_frd}")
        fields.append(f"temperature_degc={self.temperature_degc}")
        fields.append(f"timestamp_us={self.timestamp_us}")
        return f"Imu({', '.join(fields)})"


# ===== Plugin =====
class TelemetryServer:
    """Allow users to provide vehicle telemetry and state information
    (e.g. battery, GPS, RC connection, flight mode etc.) and set telemetry update rates."""

    def __init__(self, server_component):
        self._lib = _cmavsdk_lib
        self._handle = None
        self._callbacks = []  # Keep references to prevent GC

        if server_component is None:
            raise ValueError("server_component cannot be None")

        component_handle = server_component._handle

        if not component_handle:
            raise ValueError("server_component handle is null")

        self._handle = self._lib.mavsdk_telemetry_server_create(component_handle)

        if not self._handle:
            raise RuntimeError(
                "Failed to create TelemetryServer plugin - C function returned null handle"
            )

    def publish_position(self, position, velocity_ned, heading):
        """Get publish_position (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_position(
            self._handle,
            position.to_c_struct(),
            velocity_ned.to_c_struct(),
            heading.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_position failed: {result}")

        return result

    def publish_home(self, home):
        """Get publish_home (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_home(
            self._handle,
            home.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_home failed: {result}")

        return result

    def publish_sys_status(
        self,
        battery,
        rc_receiver_status,
        gyro_status,
        accel_status,
        mag_status,
        gps_status,
    ):
        """Get publish_sys_status (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_sys_status(
            self._handle,
            battery.to_c_struct(),
            rc_receiver_status,
            gyro_status,
            accel_status,
            mag_status,
            gps_status,
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_sys_status failed: {result}")

        return result

    def publish_extended_sys_state(self, vtol_state, landed_state):
        """Get publish_extended_sys_state (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_extended_sys_state(
            self._handle,
            vtol_state,
            landed_state,
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_extended_sys_state failed: {result}")

        return result

    def publish_raw_gps(self, raw_gps, gps_info):
        """Get publish_raw_gps (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_raw_gps(
            self._handle,
            raw_gps.to_c_struct(),
            gps_info.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_raw_gps failed: {result}")

        return result

    def publish_battery(self, battery):
        """Get publish_battery (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_battery(
            self._handle,
            battery.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_battery failed: {result}")

        return result

    def publish_status_text(self, status_text):
        """Get publish_status_text (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_status_text(
            self._handle,
            status_text.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_status_text failed: {result}")

        return result

    def publish_odometry(self, odometry):
        """Get publish_odometry (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_odometry(
            self._handle,
            odometry.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_odometry failed: {result}")

        return result

    def publish_position_velocity_ned(self, position_velocity_ned):
        """Get publish_position_velocity_ned (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_position_velocity_ned(
            self._handle,
            position_velocity_ned.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_position_velocity_ned failed: {result}")

        return result

    def publish_ground_truth(self, ground_truth):
        """Get publish_ground_truth (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_ground_truth(
            self._handle,
            ground_truth.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_ground_truth failed: {result}")

        return result

    def publish_imu(self, imu):
        """Get publish_imu (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_imu(
            self._handle,
            imu.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_imu failed: {result}")

        return result

    def publish_scaled_imu(self, imu):
        """Get publish_scaled_imu (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_scaled_imu(
            self._handle,
            imu.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_scaled_imu failed: {result}")

        return result

    def publish_raw_imu(self, imu):
        """Get publish_raw_imu (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_raw_imu(
            self._handle,
            imu.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_raw_imu failed: {result}")

        return result

    def publish_unix_epoch_time(self, time_us):
        """Get publish_unix_epoch_time (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_unix_epoch_time(
            self._handle,
            time_us,
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_unix_epoch_time failed: {result}")

        return result

    def publish_distance_sensor(self, distance_sensor):
        """Get publish_distance_sensor (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_distance_sensor(
            self._handle,
            distance_sensor.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_distance_sensor failed: {result}")

        return result

    def publish_attitude(self, angle, angular_velocity):
        """Get publish_attitude (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_attitude(
            self._handle,
            angle.to_c_struct(),
            angular_velocity.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_attitude failed: {result}")

        return result

    def publish_visual_flight_rules_hud(self, fixed_wing_metrics):
        """Get publish_visual_flight_rules_hud (blocking)"""

        result_code = self._lib.mavsdk_telemetry_server_publish_visual_flight_rules_hud(
            self._handle,
            fixed_wing_metrics.to_c_struct(),
        )
        result = TelemetryServerResult(result_code)
        if result != TelemetryServerResult.SUCCESS:
            raise Exception(f"publish_visual_flight_rules_hud failed: {result}")

        return result

    def destroy(self):
        """Destroy the plugin instance"""
        if self._handle:
            self._lib.mavsdk_telemetry_server_destroy(self._handle)
            self._handle = None

    def __del__(self):
        self.destroy()


# ===== Callback Types =====

# ===== Setup Functions =====
_cmavsdk_lib.mavsdk_telemetry_server_create.argtypes = [ctypes.c_void_p]
_cmavsdk_lib.mavsdk_telemetry_server_create.restype = ctypes.c_void_p

_cmavsdk_lib.mavsdk_telemetry_server_destroy.argtypes = [ctypes.c_void_p]
_cmavsdk_lib.mavsdk_telemetry_server_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_position_destroy.argtypes = [
    ctypes.POINTER(PositionCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_position_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_heading_destroy.argtypes = [
    ctypes.POINTER(HeadingCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_heading_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_quaternion_destroy.argtypes = [
    ctypes.POINTER(QuaternionCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_quaternion_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_euler_angle_destroy.argtypes = [
    ctypes.POINTER(EulerAngleCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_euler_angle_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_angular_velocity_body_destroy.argtypes = [
    ctypes.POINTER(AngularVelocityBodyCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_angular_velocity_body_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_gps_info_destroy.argtypes = [
    ctypes.POINTER(GpsInfoCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_gps_info_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_raw_gps_destroy.argtypes = [
    ctypes.POINTER(RawGpsCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_raw_gps_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_battery_destroy.argtypes = [
    ctypes.POINTER(BatteryCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_battery_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_rc_status_destroy.argtypes = [
    ctypes.POINTER(RcStatusCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_rc_status_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_status_text_destroy.argtypes = [
    ctypes.POINTER(StatusTextCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_status_text_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_actuator_control_target_destroy.argtypes = [
    ctypes.POINTER(ActuatorControlTargetCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_actuator_control_target_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_actuator_output_status_destroy.argtypes = [
    ctypes.POINTER(ActuatorOutputStatusCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_actuator_output_status_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_covariance_destroy.argtypes = [
    ctypes.POINTER(CovarianceCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_covariance_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_velocity_body_destroy.argtypes = [
    ctypes.POINTER(VelocityBodyCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_velocity_body_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_position_body_destroy.argtypes = [
    ctypes.POINTER(PositionBodyCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_position_body_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_odometry_destroy.argtypes = [
    ctypes.POINTER(OdometryCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_odometry_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_distance_sensor_destroy.argtypes = [
    ctypes.POINTER(DistanceSensorCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_distance_sensor_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_scaled_pressure_destroy.argtypes = [
    ctypes.POINTER(ScaledPressureCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_scaled_pressure_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_position_ned_destroy.argtypes = [
    ctypes.POINTER(PositionNedCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_position_ned_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_velocity_ned_destroy.argtypes = [
    ctypes.POINTER(VelocityNedCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_velocity_ned_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_position_velocity_ned_destroy.argtypes = [
    ctypes.POINTER(PositionVelocityNedCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_position_velocity_ned_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_ground_truth_destroy.argtypes = [
    ctypes.POINTER(GroundTruthCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_ground_truth_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_fixedwing_metrics_destroy.argtypes = [
    ctypes.POINTER(FixedwingMetricsCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_fixedwing_metrics_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_acceleration_frd_destroy.argtypes = [
    ctypes.POINTER(AccelerationFrdCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_acceleration_frd_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_angular_velocity_frd_destroy.argtypes = [
    ctypes.POINTER(AngularVelocityFrdCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_angular_velocity_frd_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_magnetic_field_frd_destroy.argtypes = [
    ctypes.POINTER(MagneticFieldFrdCStruct)
]
_cmavsdk_lib.mavsdk_telemetry_server_magnetic_field_frd_destroy.restype = None

_cmavsdk_lib.mavsdk_telemetry_server_imu_destroy.argtypes = [ctypes.POINTER(ImuCStruct)]
_cmavsdk_lib.mavsdk_telemetry_server_imu_destroy.restype = None


_cmavsdk_lib.mavsdk_telemetry_server_publish_position.argtypes = [
    ctypes.c_void_p,
    PositionCStruct,
    VelocityNedCStruct,
    HeadingCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_position.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_home.argtypes = [
    ctypes.c_void_p,
    PositionCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_home.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_sys_status.argtypes = [
    ctypes.c_void_p,
    BatteryCStruct,
    ctypes.c_bool,
    ctypes.c_bool,
    ctypes.c_bool,
    ctypes.c_bool,
    ctypes.c_bool,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_sys_status.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_extended_sys_state.argtypes = [
    ctypes.c_void_p,
    ctypes.c_int,
    ctypes.c_int,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_extended_sys_state.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_raw_gps.argtypes = [
    ctypes.c_void_p,
    RawGpsCStruct,
    GpsInfoCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_raw_gps.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_battery.argtypes = [
    ctypes.c_void_p,
    BatteryCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_battery.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_status_text.argtypes = [
    ctypes.c_void_p,
    StatusTextCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_status_text.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_odometry.argtypes = [
    ctypes.c_void_p,
    OdometryCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_odometry.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_position_velocity_ned.argtypes = [
    ctypes.c_void_p,
    PositionVelocityNedCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_position_velocity_ned.restype = (
    ctypes.c_int
)

_cmavsdk_lib.mavsdk_telemetry_server_publish_ground_truth.argtypes = [
    ctypes.c_void_p,
    GroundTruthCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_ground_truth.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_imu.argtypes = [
    ctypes.c_void_p,
    ImuCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_imu.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_scaled_imu.argtypes = [
    ctypes.c_void_p,
    ImuCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_scaled_imu.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_raw_imu.argtypes = [
    ctypes.c_void_p,
    ImuCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_raw_imu.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_unix_epoch_time.argtypes = [
    ctypes.c_void_p,
    ctypes.c_uint64,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_unix_epoch_time.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_distance_sensor.argtypes = [
    ctypes.c_void_p,
    DistanceSensorCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_distance_sensor.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_attitude.argtypes = [
    ctypes.c_void_p,
    EulerAngleCStruct,
    AngularVelocityBodyCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_attitude.restype = ctypes.c_int

_cmavsdk_lib.mavsdk_telemetry_server_publish_visual_flight_rules_hud.argtypes = [
    ctypes.c_void_p,
    FixedwingMetricsCStruct,
]

_cmavsdk_lib.mavsdk_telemetry_server_publish_visual_flight_rules_hud.restype = (
    ctypes.c_int
)
