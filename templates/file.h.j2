// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/{{ plugin_name.lower_snake_case }}/{{ plugin_name.lower_snake_case }}.proto)

#ifndef CMAVSDK_{{ plugin_name.uppercase }}_H
#define CMAVSDK_{{ plugin_name.uppercase }}_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief {{ class_description | replace('\n', '\n *')}}
 */

// ===== Forward Declarations =====
typedef void* mavsdk_system_t;

// ===== Opaque Handles =====
typedef void* mavsdk_{{ plugin_name.lower_snake_case }}_t;
{% for method in methods %}
{% if method.is_stream %}
typedef void* mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}_handle_t;
{% endif %}
{% endfor %}

// ===== Enums =====
{% for enum in enums %}
/**
 * @brief {{ enum.enum_description | replace('\n', '\n *')}}
 */
typedef enum {
    {% for value in enum.values %}
    /** {{ value.description.rstrip() }}. */
    MAVSDK_{{ plugin_name.uppercase }}_{{ enum.name.uppercase }}_{{ value.name.uppercase }} = {{ loop.index0 }},
    {% endfor %}
} mavsdk_{{ plugin_name.lower_snake_case }}_{{ enum.name.lower_snake_case }}_t;

{% endfor %}

// ===== Structs =====
{% for struct in structs %}
{% if struct.name.upper_camel_case.endswith('Result') %}
{% for nested_enum_name, nested_enum in struct.nested_enums.items() %}
{% if nested_enum_name == 'Result' %}
/**
 * @brief {{ nested_enum.enum_description | replace('\n', '\n *')}}
 */
typedef enum {
    {% for value in nested_enum.values %}
    /** {{ value.description.rstrip() }}. */
    MAVSDK_{{ plugin_name.uppercase }}_RESULT_{{ value.name.uppercase }} = {{ loop.index0 }},
    {% endfor %}
} mavsdk_{{ plugin_name.lower_snake_case }}_result_t;

{% endif %}
{% endfor %}
{% else %}
{% for nested_enum_name, nested_enum in struct.nested_enums.items() %}
/**
 * @brief {{ nested_enum.enum_description | replace('\n', '\n *')}}
 */
typedef enum {
    {% for value in nested_enum.values %}
    /** {{ value.description.rstrip() }}. */
    MAVSDK_{{ plugin_name.uppercase }}_{{ struct.name.uppercase }}_{{ nested_enum.name.uppercase }}_{{ value.name.uppercase }} = {{ loop.index0 }},
    {% endfor %}
} mavsdk_{{ plugin_name.lower_snake_case }}_{{ struct.name.lower_snake_case }}_{{ nested_enum.name.lower_snake_case }}_t;

{% endfor %}
/**
 * @brief {{ struct.struct_description | replace('\n', '\n * ') }}
 {% if struct.fields | selectattr('type_info.is_repeated') | list %}
 * 
 * @note This struct contains dynamically allocated memory. You must call
 *       mavsdk_{{ plugin_name.lower_snake_case }}_{{ struct.name.lower_snake_case }}_destroy() when done to avoid memory leaks.
 {% endif %}
 */
typedef struct {
    {% for field in struct.fields %}
    /** {{ field.description.rstrip() }} */
    {% if field.type_info.is_primitive %}
    {{ field.type_info.name }} {{ field.name.lower_snake_case }};
    {% elif field.type_info.parent_type %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ field.type_info.parent_type.lower_snake_case }}_{{ field.type_info.name.lower_snake_case }}_t {{ field.name.lower_snake_case }};
    {% else %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ field.type_info.name.lower_snake_case }}_t {{ field.name.lower_snake_case }};
    {% endif %}
    {% if field.type_info.is_repeated %}
    int {{ field.name.lower_snake_case }}_size;
    {% endif %}
    {% endfor %}
} mavsdk_{{ plugin_name.lower_snake_case }}_{{ struct.name.lower_snake_case }}_t;
{% endif %}

{% if struct.fields | selectattr('type_info.is_repeated') | list %}
/**
 * @brief Destroy a {{ struct.name.lower_snake_case }} struct.
 * 
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * 
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
void mavsdk_{{ plugin_name.lower_snake_case }}_{{ struct.name.lower_snake_case }}_destroy(
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ struct.name.lower_snake_case }}_t* target);
{% endif %}

{% endfor %}

// ===== Callback Typedefs =====
{% for method in methods %}
{% if method.is_async %}
typedef void (*mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}_callback_t)({% if method.has_result %}const mavsdk_{{ plugin_name.lower_snake_case }}_result_t result, {% endif %}{% if method.return_type %}const {% if method.return_type.is_primitive %}{{ method.return_type.name }}{% else %}mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.return_type.name.lower_snake_case }}_t{% endif %} {{ method.name.lower_snake_case }}, {% endif %}void* user_data);
{% endif %}
{% endfor %}

// ===== {{ plugin_name.upper_camel_case }} Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_{{ plugin_name.lower_snake_case }}_t mavsdk_{{ plugin_name.lower_snake_case }}_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_{{ plugin_name.lower_snake_case }}_destroy(mavsdk_{{ plugin_name.lower_snake_case }}_t {{ plugin_name.lower_snake_case }});

// ===== Methods =====
{% for method in methods %}
{% if method.is_async %}

/**
 * @brief {{ method.method_description | replace('\n', '\n * ') }}
 * 
 * @param {{ plugin_name.lower_snake_case }} The {{ plugin_name.lower_snake_case }} instance.
 {% for param in method.params -%}
 * @param {{ param.name.lower_snake_case }} {{ param.description | replace('\n', '\n * ') if param.description else 'The ' + param.name.lower_snake_case + ' parameter.' }}
 {% endfor %}
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 {% if method.is_stream and not method.is_finite %}
 * @return Handle for this subscription. Use mavsdk_{{ plugin_name.lower_snake_case }}_unsubscribe_{{ method.name.lower_snake_case }}() to unsubscribe.
 {% endif %}
 */
CMAVSDK_EXPORT {% if method.is_stream and not method.is_finite%}mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}_handle_t{% else %}void{% endif %} mavsdk_{{ plugin_name.lower_snake_case }}{% if method.is_stream and not method.is_finite%}_subscribe{% endif %}_{{ method.name.lower_snake_case }}{% if not method.is_stream or method.is_finite %}_async{% endif %}(
    mavsdk_{{ plugin_name.lower_snake_case }}_t {{ plugin_name.lower_snake_case }},
    {% for param in method.params %}
    {% if param.type_info.is_primitive %}
    {{ param.type_info.name }} {{ param.name.lower_snake_case }},
    {% elif param.type_info.parent_type %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ param.type_info.parent_type.lower_snake_case }}_{{ param.type_info.name.lower_snake_case }}_t {{ param.name.lower_snake_case }},
    {% else %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ param.type_info.name.lower_snake_case }}_t {{ param.name.lower_snake_case }},
    {% endif %}
    {% endfor %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}_callback_t callback,
    void* user_data);

{% if method.is_stream and not method.is_finite %}
/**
 * @brief Unsubscribe from '{{ method.name.lower_snake_case }}' updates.
 * 
 * Stops the subscription and frees resources associated with the handle.
 * 
 * @param {{ plugin_name.lower_snake_case }} The {{ plugin_name.lower_snake_case }} instance.
 * @param handle The subscription handle returned by mavsdk_{{ plugin_name.lower_snake_case }}_subscribe_{{ method.name.lower_snake_case }}().
 */
CMAVSDK_EXPORT void mavsdk_{{ plugin_name.lower_snake_case }}_unsubscribe_{{ method.name.lower_snake_case }}(
    mavsdk_{{ plugin_name.lower_snake_case }}_t {{ plugin_name.lower_snake_case }},
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}_handle_t);
{% endif %}
{% endif %}

{% if method.is_sync %}
/**
 * @brief Get the current {{ method.name.lower_snake_case | replace('_', ' ') }} (blocking).
 * 
 * This function blocks until a value is available.
 * 
 * @param telemetry The telemetry instance.
 * @param {{ method.name.lower_snake_case }}_out Pointer to store the result.
 */
CMAVSDK_EXPORT
{% if method.has_result %}
mavsdk_{{ plugin_name.lower_snake_case }}_result_t
{% else %}
void
{% endif %}
mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.name.lower_snake_case }}(
    mavsdk_{{ plugin_name.lower_snake_case }}_t {{ plugin_name.lower_snake_case }}{% if method.params %},
    {% for param in method.params %}
    {% if param.type_info.is_primitive %}
    {{ param.type_info.name }} {{ param.name.lower_snake_case }}{% if not loop.last %},
    {% endif %}
    {% elif param.type_info.parent_type %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ param.type_info.parent_type.lower_snake_case }}_{{ param.type_info.name.lower_snake_case }}_t {{ param.name.lower_snake_case }}{% if not loop.last %},
    {% endif %}
    {% else %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ param.type_info.name.lower_snake_case }}_t {{ param.name.lower_snake_case }}{% if not loop.last %},
    {% endif %}
    {% endif %}
    {% endfor %}{% endif %}{% if method.return_name %},
    {% if method.return_type.is_primitive %}
    {{ method.return_type.name }}* {{ method.return_name.lower_snake_case }}_out
    {% else %}
    mavsdk_{{ plugin_name.lower_snake_case }}_{{ method.return_type.name.lower_snake_case }}_t* {{ method.return_name.lower_snake_case }}_out{% endif %}{% endif %});

{% endif %}
{% endfor %}

#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_{{ plugin_name.uppercase }}_H
