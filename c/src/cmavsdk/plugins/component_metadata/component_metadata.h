// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/component_metadata/component_metadata.proto)

#ifndef CMAVSDK_COMPONENT_METADATA_H
#define CMAVSDK_COMPONENT_METADATA_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Access component metadata json definitions, such as parameters.
 */

// ===== Forward Declarations =====
typedef void* mavsdk_system_t;

// ===== Opaque Handles =====
typedef void* mavsdk_component_metadata_t;
typedef void* mavsdk_component_metadata_metadata_available_handle_t;

// ===== Enums =====
/**
 * @brief The metadata type
 */
typedef enum {
    /**  This is set in the subscription callback when all metadata types completed for a given component ID. */
    MAVSDK_COMPONENT_METADATA_METADATA_TYPE_ALL_COMPLETED = 0,
    /**  Parameter metadata. */
    MAVSDK_COMPONENT_METADATA_METADATA_TYPE_PARAMETER = 1,
    /**  Event definitions. */
    MAVSDK_COMPONENT_METADATA_METADATA_TYPE_EVENTS = 2,
    /**  Actuator definitions. */
    MAVSDK_COMPONENT_METADATA_METADATA_TYPE_ACTUATORS = 3,
} mavsdk_component_metadata_metadata_type_t;


// ===== Structs =====
/**
 * @brief Metadata response
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_component_metadata_metadata_data_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  The JSON metadata */
    char* json_metadata;
} mavsdk_component_metadata_metadata_data_t;

/**
 * @brief Destroy a metadata_data struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_metadata_data_destroy(
    mavsdk_component_metadata_metadata_data_t* target);

/**
 * @brief Destroy an array of metadata_data structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_metadata_data_array_destroy(
    mavsdk_component_metadata_metadata_data_t** array,
    size_t size);

/**
 * @brief Possible results returned
 */
typedef enum {
    /**  Success. */
    MAVSDK_COMPONENT_METADATA_RESULT_SUCCESS = 0,
    /**  Not available. */
    MAVSDK_COMPONENT_METADATA_RESULT_NOT_AVAILABLE = 1,
    /**  Connection error. */
    MAVSDK_COMPONENT_METADATA_RESULT_CONNECTION_ERROR = 2,
    /**  Unsupported. */
    MAVSDK_COMPONENT_METADATA_RESULT_UNSUPPORTED = 3,
    /**  Denied. */
    MAVSDK_COMPONENT_METADATA_RESULT_DENIED = 4,
    /**  Failed. */
    MAVSDK_COMPONENT_METADATA_RESULT_FAILED = 5,
    /**  Timeout. */
    MAVSDK_COMPONENT_METADATA_RESULT_TIMEOUT = 6,
    /**  No system. */
    MAVSDK_COMPONENT_METADATA_RESULT_NO_SYSTEM = 7,
    /**  Not requested. */
    MAVSDK_COMPONENT_METADATA_RESULT_NOT_REQUESTED = 8,
} mavsdk_component_metadata_result_t;


/**
 * @brief Metadata for a given component and type
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_component_metadata_metadata_update_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  The component ID */
    uint32_t compid;
    /**  The metadata type */
    mavsdk_component_metadata_metadata_type_t type;
    /**  The JSON metadata */
    char* json_metadata;
} mavsdk_component_metadata_metadata_update_t;

/**
 * @brief Destroy a metadata_update struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_metadata_update_destroy(
    mavsdk_component_metadata_metadata_update_t* target);

/**
 * @brief Destroy an array of metadata_update structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_metadata_update_array_destroy(
    mavsdk_component_metadata_metadata_update_t** array,
    size_t size);


// ===== Primitive Array Destroy Functions =====
/**
 * @brief Destroy an array of float.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_float_array_destroy(float** array);
/**
 * @brief Destroy an array of double.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_double_array_destroy(double** array);
/**
 * @brief Destroy an array of int32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_int32t_array_destroy(int32_t** array);
/**
 * @brief Destroy an array of uint32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_uint32t_array_destroy(uint32_t** array);
/**
 * @brief Destroy an array of int64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_int64t_array_destroy(int64_t** array);
/**
 * @brief Destroy an array of uint64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_uint64t_array_destroy(uint64_t** array);
/**
 * @brief Destroy an array of bool.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_bool_array_destroy(bool** array);

/**
 * @brief Destroy a string (char*).
 *
 * Frees the memory allocated for the string.
 *
 * @param str Pointer to the string pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_string_destroy(char** str);

/**
 * @brief Destroy a byte buffer (uint8_t*).
 *
 * Frees the memory allocated for the byte buffer.
 *
 * @param buffer Pointer to the buffer pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_byte_buffer_destroy(uint8_t** buffer);

// ===== Callback Typedefs =====
typedef void (*mavsdk_component_metadata_metadata_available_callback_t)(const mavsdk_component_metadata_metadata_update_t data, void* user_data);

// ===== ComponentMetadata Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_component_metadata_t mavsdk_component_metadata_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_component_metadata_destroy(mavsdk_component_metadata_t component_metadata);

// ===== Methods =====

/**
 * @brief Get the current request component (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param request_component_out Pointer to store the result.
 */
CMAVSDK_EXPORT
void
mavsdk_component_metadata_request_component(
    mavsdk_component_metadata_t component_metadata,
    uint32_t compid);


/**
 * @brief Get the current request autopilot component (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param request_autopilot_component_out Pointer to store the result.
 */
CMAVSDK_EXPORT
void
mavsdk_component_metadata_request_autopilot_component(
    mavsdk_component_metadata_t component_metadata);


/**
 * @brief Register a callback that gets called when metadata is available
 *
 * @param component_metadata The component_metadata instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 * @return Handle for this subscription. Use mavsdk_component_metadata_unsubscribe_metadata_available() to unsubscribe.
 */
CMAVSDK_EXPORT mavsdk_component_metadata_metadata_available_handle_t mavsdk_component_metadata_subscribe_metadata_available(
    mavsdk_component_metadata_t component_metadata,
    mavsdk_component_metadata_metadata_available_callback_t callback,
    void* user_data);

/**
 * @brief Unsubscribe from 'metadata_available' updates.
 *
 * Stops the subscription and frees resources associated with the handle.
 *
 * @param component_metadata The component_metadata instance.
 * @param handle The subscription handle returned by mavsdk_component_metadata_subscribe_metadata_available().
 */
CMAVSDK_EXPORT void mavsdk_component_metadata_unsubscribe_metadata_available(
    mavsdk_component_metadata_t component_metadata,
    mavsdk_component_metadata_metadata_available_handle_t);


/**
 * @brief Get the current get metadata (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param get_metadata_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_component_metadata_result_t
mavsdk_component_metadata_get_metadata(
    mavsdk_component_metadata_t component_metadata,
    uint32_t compid,
    mavsdk_component_metadata_metadata_type_t metadata_type,
    mavsdk_component_metadata_metadata_data_t* response_out);


#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_COMPONENT_METADATA_H