// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/calibration/calibration.proto)

#ifndef CMAVSDK_CALIBRATION_H
#define CMAVSDK_CALIBRATION_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Enable to calibrate sensors of a drone such as gyro, accelerometer, and magnetometer.
 */

// ===== Forward Declarations =====
typedef void* mavsdk_system_t;

// ===== Opaque Handles =====
typedef void* mavsdk_calibration_t;
typedef void* mavsdk_calibration_calibrate_gyro_handle_t;
typedef void* mavsdk_calibration_calibrate_accelerometer_handle_t;
typedef void* mavsdk_calibration_calibrate_magnetometer_handle_t;
typedef void* mavsdk_calibration_calibrate_level_horizon_handle_t;
typedef void* mavsdk_calibration_calibrate_gimbal_accelerometer_handle_t;

// ===== Enums =====

// ===== Structs =====
/**
 * @brief Possible results returned for calibration commands
 */
typedef enum {
    /**  Unknown result. */
    MAVSDK_CALIBRATION_RESULT_UNKNOWN = 0,
    /**  The calibration succeeded. */
    MAVSDK_CALIBRATION_RESULT_SUCCESS = 1,
    /**  Intermediate message showing progress or instructions on the next steps. */
    MAVSDK_CALIBRATION_RESULT_NEXT = 2,
    /**  Calibration failed. */
    MAVSDK_CALIBRATION_RESULT_FAILED = 3,
    /**  No system is connected. */
    MAVSDK_CALIBRATION_RESULT_NO_SYSTEM = 4,
    /**  Connection error. */
    MAVSDK_CALIBRATION_RESULT_CONNECTION_ERROR = 5,
    /**  Vehicle is busy. */
    MAVSDK_CALIBRATION_RESULT_BUSY = 6,
    /**  Command refused by vehicle. */
    MAVSDK_CALIBRATION_RESULT_COMMAND_DENIED = 7,
    /**  Command timed out. */
    MAVSDK_CALIBRATION_RESULT_TIMEOUT = 8,
    /**  Calibration process was cancelled. */
    MAVSDK_CALIBRATION_RESULT_CANCELLED = 9,
    /**  Calibration process failed since the vehicle is armed. */
    MAVSDK_CALIBRATION_RESULT_FAILED_ARMED = 10,
    /**  Functionality not supported. */
    MAVSDK_CALIBRATION_RESULT_UNSUPPORTED = 11,
} mavsdk_calibration_result_t;


/**
 * @brief Progress data coming from calibration.
 * 
 *  Can be a progress percentage, or an instruction text.
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_calibration_progress_data_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  Whether this ProgressData contains a 'progress' status or not */
    bool has_progress;
    /**  Progress (percentage) */
    float progress;
    /**  Whether this ProgressData contains a 'status_text' or not */
    bool has_status_text;
    /**  Instruction text */
    char* status_text;
} mavsdk_calibration_progress_data_t;

/**
 * @brief Destroy a progress_data struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_calibration_progress_data_destroy(
    mavsdk_calibration_progress_data_t* target);

/**
 * @brief Destroy an array of progress_data structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_calibration_progress_data_array_destroy(
    mavsdk_calibration_progress_data_t** array,
    size_t size);


// ===== Primitive Array Destroy Functions =====
/**
 * @brief Destroy an array of float.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_float_array_destroy(float** array);
/**
 * @brief Destroy an array of double.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_double_array_destroy(double** array);
/**
 * @brief Destroy an array of int32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_int32t_array_destroy(int32_t** array);
/**
 * @brief Destroy an array of uint32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_uint32t_array_destroy(uint32_t** array);
/**
 * @brief Destroy an array of int64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_int64t_array_destroy(int64_t** array);
/**
 * @brief Destroy an array of uint64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_uint64t_array_destroy(uint64_t** array);
/**
 * @brief Destroy an array of bool.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_bool_array_destroy(bool** array);

/**
 * @brief Destroy a string (char*).
 *
 * Frees the memory allocated for the string.
 *
 * @param str Pointer to the string pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_string_destroy(char** str);

/**
 * @brief Destroy a byte buffer (uint8_t*).
 *
 * Frees the memory allocated for the byte buffer.
 *
 * @param buffer Pointer to the buffer pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_calibration_byte_buffer_destroy(uint8_t** buffer);

// ===== Callback Typedefs =====
typedef void (*mavsdk_calibration_calibrate_gyro_callback_t)(const mavsdk_calibration_result_t result, const mavsdk_calibration_progress_data_t progress_data, void* user_data);
typedef void (*mavsdk_calibration_calibrate_accelerometer_callback_t)(const mavsdk_calibration_result_t result, const mavsdk_calibration_progress_data_t progress_data, void* user_data);
typedef void (*mavsdk_calibration_calibrate_magnetometer_callback_t)(const mavsdk_calibration_result_t result, const mavsdk_calibration_progress_data_t progress_data, void* user_data);
typedef void (*mavsdk_calibration_calibrate_level_horizon_callback_t)(const mavsdk_calibration_result_t result, const mavsdk_calibration_progress_data_t progress_data, void* user_data);
typedef void (*mavsdk_calibration_calibrate_gimbal_accelerometer_callback_t)(const mavsdk_calibration_result_t result, const mavsdk_calibration_progress_data_t progress_data, void* user_data);

// ===== Calibration Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_calibration_t mavsdk_calibration_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_calibration_destroy(mavsdk_calibration_t calibration);

// ===== Methods =====

/**
 * @brief Perform gyro calibration.
 *
 * @param calibration The calibration instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_calibration_calibrate_gyro_async(
    mavsdk_calibration_t calibration,
    mavsdk_calibration_calibrate_gyro_callback_t callback,
    void* user_data);



/**
 * @brief Perform accelerometer calibration.
 *
 * @param calibration The calibration instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_calibration_calibrate_accelerometer_async(
    mavsdk_calibration_t calibration,
    mavsdk_calibration_calibrate_accelerometer_callback_t callback,
    void* user_data);



/**
 * @brief Perform magnetometer calibration.
 *
 * @param calibration The calibration instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_calibration_calibrate_magnetometer_async(
    mavsdk_calibration_t calibration,
    mavsdk_calibration_calibrate_magnetometer_callback_t callback,
    void* user_data);



/**
 * @brief Perform board level horizon calibration.
 *
 * @param calibration The calibration instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_calibration_calibrate_level_horizon_async(
    mavsdk_calibration_t calibration,
    mavsdk_calibration_calibrate_level_horizon_callback_t callback,
    void* user_data);



/**
 * @brief Perform gimbal accelerometer calibration.
 *
 * @param calibration The calibration instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_calibration_calibrate_gimbal_accelerometer_async(
    mavsdk_calibration_t calibration,
    mavsdk_calibration_calibrate_gimbal_accelerometer_callback_t callback,
    void* user_data);



/**
 * @brief Get the current cancel (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param cancel_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_calibration_result_t
mavsdk_calibration_cancel(
    mavsdk_calibration_t calibration);


#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_CALIBRATION_H