// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/failure/failure.proto)

#include "failure.h"

#include <mavsdk/plugins/failure/failure.h>
#include <algorithm>
#include <cstring>
#include <mutex>
#include <vector>

// ===== C++ to C Type Conversions =====

static mavsdk_failure_result_t
translate_result(mavsdk::Failure::Result cpp_result) {
    switch(cpp_result) {
        case mavsdk::Failure::Result::Unknown:
            return MAVSDK_FAILURE_RESULT_UNKNOWN;
        case mavsdk::Failure::Result::Success:
            return MAVSDK_FAILURE_RESULT_SUCCESS;
        case mavsdk::Failure::Result::NoSystem:
            return MAVSDK_FAILURE_RESULT_NO_SYSTEM;
        case mavsdk::Failure::Result::ConnectionError:
            return MAVSDK_FAILURE_RESULT_CONNECTION_ERROR;
        case mavsdk::Failure::Result::Unsupported:
            return MAVSDK_FAILURE_RESULT_UNSUPPORTED;
        case mavsdk::Failure::Result::Denied:
            return MAVSDK_FAILURE_RESULT_DENIED;
        case mavsdk::Failure::Result::Disabled:
            return MAVSDK_FAILURE_RESULT_DISABLED;
        case mavsdk::Failure::Result::Timeout:
            return MAVSDK_FAILURE_RESULT_TIMEOUT;
    }
}

static mavsdk::Failure::FailureUnit
translate_failure_unit_from_c(mavsdk_failure_failure_unit_t c_enum) {
    switch(c_enum) {
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_GYRO:
            return mavsdk::Failure::FailureUnit::SensorGyro;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_ACCEL:
            return mavsdk::Failure::FailureUnit::SensorAccel;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_MAG:
            return mavsdk::Failure::FailureUnit::SensorMag;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_BARO:
            return mavsdk::Failure::FailureUnit::SensorBaro;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_GPS:
            return mavsdk::Failure::FailureUnit::SensorGps;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_OPTICAL_FLOW:
            return mavsdk::Failure::FailureUnit::SensorOpticalFlow;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_VIO:
            return mavsdk::Failure::FailureUnit::SensorVio;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_DISTANCE_SENSOR:
            return mavsdk::Failure::FailureUnit::SensorDistanceSensor;
        case MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_AIRSPEED:
            return mavsdk::Failure::FailureUnit::SensorAirspeed;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_BATTERY:
            return mavsdk::Failure::FailureUnit::SystemBattery;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_MOTOR:
            return mavsdk::Failure::FailureUnit::SystemMotor;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_SERVO:
            return mavsdk::Failure::FailureUnit::SystemServo;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_AVOIDANCE:
            return mavsdk::Failure::FailureUnit::SystemAvoidance;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_RC_SIGNAL:
            return mavsdk::Failure::FailureUnit::SystemRcSignal;
        case MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_MAVLINK_SIGNAL:
            return mavsdk::Failure::FailureUnit::SystemMavlinkSignal;
    }
    return mavsdk::Failure::FailureUnit::SensorGyro;
}

static mavsdk_failure_failure_unit_t
translate_failure_unit_to_c(mavsdk::Failure::FailureUnit cpp_enum) {
    switch(cpp_enum) {
        case mavsdk::Failure::FailureUnit::SensorGyro:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_GYRO;
        case mavsdk::Failure::FailureUnit::SensorAccel:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_ACCEL;
        case mavsdk::Failure::FailureUnit::SensorMag:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_MAG;
        case mavsdk::Failure::FailureUnit::SensorBaro:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_BARO;
        case mavsdk::Failure::FailureUnit::SensorGps:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_GPS;
        case mavsdk::Failure::FailureUnit::SensorOpticalFlow:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_OPTICAL_FLOW;
        case mavsdk::Failure::FailureUnit::SensorVio:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_VIO;
        case mavsdk::Failure::FailureUnit::SensorDistanceSensor:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_DISTANCE_SENSOR;
        case mavsdk::Failure::FailureUnit::SensorAirspeed:
            return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_AIRSPEED;
        case mavsdk::Failure::FailureUnit::SystemBattery:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_BATTERY;
        case mavsdk::Failure::FailureUnit::SystemMotor:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_MOTOR;
        case mavsdk::Failure::FailureUnit::SystemServo:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_SERVO;
        case mavsdk::Failure::FailureUnit::SystemAvoidance:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_AVOIDANCE;
        case mavsdk::Failure::FailureUnit::SystemRcSignal:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_RC_SIGNAL;
        case mavsdk::Failure::FailureUnit::SystemMavlinkSignal:
            return MAVSDK_FAILURE_FAILURE_UNIT_SYSTEM_MAVLINK_SIGNAL;
    }
    return MAVSDK_FAILURE_FAILURE_UNIT_SENSOR_GYRO;
}

static mavsdk::Failure::FailureType
translate_failure_type_from_c(mavsdk_failure_failure_type_t c_enum) {
    switch(c_enum) {
        case MAVSDK_FAILURE_FAILURE_TYPE_OK:
            return mavsdk::Failure::FailureType::Ok;
        case MAVSDK_FAILURE_FAILURE_TYPE_OFF:
            return mavsdk::Failure::FailureType::Off;
        case MAVSDK_FAILURE_FAILURE_TYPE_STUCK:
            return mavsdk::Failure::FailureType::Stuck;
        case MAVSDK_FAILURE_FAILURE_TYPE_GARBAGE:
            return mavsdk::Failure::FailureType::Garbage;
        case MAVSDK_FAILURE_FAILURE_TYPE_WRONG:
            return mavsdk::Failure::FailureType::Wrong;
        case MAVSDK_FAILURE_FAILURE_TYPE_SLOW:
            return mavsdk::Failure::FailureType::Slow;
        case MAVSDK_FAILURE_FAILURE_TYPE_DELAYED:
            return mavsdk::Failure::FailureType::Delayed;
        case MAVSDK_FAILURE_FAILURE_TYPE_INTERMITTENT:
            return mavsdk::Failure::FailureType::Intermittent;
    }
    return mavsdk::Failure::FailureType::Ok;
}

static mavsdk_failure_failure_type_t
translate_failure_type_to_c(mavsdk::Failure::FailureType cpp_enum) {
    switch(cpp_enum) {
        case mavsdk::Failure::FailureType::Ok:
            return MAVSDK_FAILURE_FAILURE_TYPE_OK;
        case mavsdk::Failure::FailureType::Off:
            return MAVSDK_FAILURE_FAILURE_TYPE_OFF;
        case mavsdk::Failure::FailureType::Stuck:
            return MAVSDK_FAILURE_FAILURE_TYPE_STUCK;
        case mavsdk::Failure::FailureType::Garbage:
            return MAVSDK_FAILURE_FAILURE_TYPE_GARBAGE;
        case mavsdk::Failure::FailureType::Wrong:
            return MAVSDK_FAILURE_FAILURE_TYPE_WRONG;
        case mavsdk::Failure::FailureType::Slow:
            return MAVSDK_FAILURE_FAILURE_TYPE_SLOW;
        case mavsdk::Failure::FailureType::Delayed:
            return MAVSDK_FAILURE_FAILURE_TYPE_DELAYED;
        case mavsdk::Failure::FailureType::Intermittent:
            return MAVSDK_FAILURE_FAILURE_TYPE_INTERMITTENT;
    }
    return MAVSDK_FAILURE_FAILURE_TYPE_OK;
}




// ===== Primitive Array Destroy Functions =====
void mavsdk_failure_float_array_destroy(float** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_double_array_destroy(double** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_int32t_array_destroy(int32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_uint32t_array_destroy(uint32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_int64t_array_destroy(int64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_uint64t_array_destroy(uint64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_failure_bool_array_destroy(bool** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}


void mavsdk_failure_string_destroy(char** str) {
    if (!str || !*str) return;
    free(*str);
    *str = nullptr;
}

void mavsdk_failure_byte_buffer_destroy(uint8_t** buffer) {
    if (!buffer || !*buffer) return;
    delete[] *buffer;
    *buffer = nullptr;
}

// ===== Failure Wrapper =====

struct mavsdk_failure_wrapper {
    std::shared_ptr<mavsdk::Failure> cpp_plugin;
    std::mutex handles_mutex;
};

mavsdk_failure_t
mavsdk_failure_create(mavsdk_system_t system) {
    if (system == nullptr) {
        return nullptr;
    }

    auto wrapper = new mavsdk_failure_wrapper();
    auto system_ptr = reinterpret_cast<std::shared_ptr<mavsdk::System>*>(system);
    wrapper->cpp_plugin = std::make_shared<mavsdk::Failure>(*system_ptr);

    return reinterpret_cast<mavsdk_failure_t>(wrapper);
}

void mavsdk_failure_destroy(mavsdk_failure_t failure) {
    if (failure == nullptr) {
        return;
    }

    auto wrapper = reinterpret_cast<mavsdk_failure_wrapper*>(failure);

    // Unsubscribe all active streams before destroying to prevent
    // callbacks firing into a destroyed object
    {
        std::lock_guard<std::mutex> lock(wrapper->handles_mutex);
    }

    delete wrapper;
}

// ===== Method Implementations =====


// Inject sync
mavsdk_failure_result_t
mavsdk_failure_inject(
    mavsdk_failure_t failure,
    mavsdk_failure_failure_unit_t failure_unit,
    mavsdk_failure_failure_type_t failure_type,
    int32_t instance)
{
    auto wrapper = reinterpret_cast<mavsdk_failure_wrapper*>(failure);

    auto ret_value = wrapper->cpp_plugin->inject(        translate_failure_unit_from_c(failure_unit),        translate_failure_type_from_c(failure_type),        instance);

    return translate_result(ret_value);
}
