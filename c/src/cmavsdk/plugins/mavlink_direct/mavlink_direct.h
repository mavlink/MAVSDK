// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/mavlink_direct/mavlink_direct.proto)

#ifndef CMAVSDK_MAVLINK_DIRECT_H
#define CMAVSDK_MAVLINK_DIRECT_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Enable direct MAVLink communication using libmav.
 */

// ===== Forward Declarations =====
typedef struct mavsdk_system_s *mavsdk_system_t;

// ===== Opaque Handles =====
typedef struct mavsdk_mavlink_direct_s *mavsdk_mavlink_direct_t;
typedef struct mavsdk_mavlink_direct_message_handle_s *mavsdk_mavlink_direct_message_handle_t;

// ===== Enums =====

// ===== Structs =====
/**
 * @brief A complete MAVLink message with all header information and fields
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_mavlink_direct_mavlink_message_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  MAVLink message name (e.g., "HEARTBEAT", "GLOBAL_POSITION_INT") */
    char* message_name;
    /**  System ID of the sender (for received messages) */
    uint32_t system_id;
    /**  Component ID of the sender (for received messages) */
    uint32_t component_id;
    /**  Target system ID (for sending, 0 for broadcast) */
    uint32_t target_system_id;
    /**  Target component ID (for sending, 0 for broadcast) */
    uint32_t target_component_id;
    /**  All message fields as single JSON object */
    char* fields_json;
} mavsdk_mavlink_direct_mavlink_message_t;

/**
 * @brief Destroy a mavlink_message struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_mavlink_message_destroy(
    mavsdk_mavlink_direct_mavlink_message_t* target);

/**
 * @brief Destroy an array of mavlink_message structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_mavlink_message_array_destroy(
    mavsdk_mavlink_direct_mavlink_message_t** array,
    size_t size);

/**
 * @brief Possible results returned for action requests.
 */
typedef enum {
    /**  Unknown result. */
    MAVSDK_MAVLINK_DIRECT_RESULT_UNKNOWN = 0,
    /**  Request succeeded. */
    MAVSDK_MAVLINK_DIRECT_RESULT_SUCCESS = 1,
    /**  Error. */
    MAVSDK_MAVLINK_DIRECT_RESULT_ERROR = 2,
    /**  Invalid MAVLink message. */
    MAVSDK_MAVLINK_DIRECT_RESULT_INVALID_MESSAGE = 3,
    /**  Invalid field name or value. */
    MAVSDK_MAVLINK_DIRECT_RESULT_INVALID_FIELD = 4,
    /**  Connection error. */
    MAVSDK_MAVLINK_DIRECT_RESULT_CONNECTION_ERROR = 5,
    /**  No system connected. */
    MAVSDK_MAVLINK_DIRECT_RESULT_NO_SYSTEM = 6,
    /**  Request timed out. */
    MAVSDK_MAVLINK_DIRECT_RESULT_TIMEOUT = 7,
} mavsdk_mavlink_direct_result_t;



// ===== Primitive Array Destroy Functions =====
/**
 * @brief Destroy an array of float.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_float_array_destroy(float** array);
/**
 * @brief Destroy an array of double.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_double_array_destroy(double** array);
/**
 * @brief Destroy an array of int32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_int32t_array_destroy(int32_t** array);
/**
 * @brief Destroy an array of uint32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_uint32t_array_destroy(uint32_t** array);
/**
 * @brief Destroy an array of int64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_int64t_array_destroy(int64_t** array);
/**
 * @brief Destroy an array of uint64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_uint64t_array_destroy(uint64_t** array);
/**
 * @brief Destroy an array of bool.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_bool_array_destroy(bool** array);

/**
 * @brief Destroy a string (char*).
 *
 * Frees the memory allocated for the string.
 *
 * @param str Pointer to the string pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_string_destroy(char** str);

/**
 * @brief Destroy a byte buffer (uint8_t*).
 *
 * Frees the memory allocated for the byte buffer.
 *
 * @param buffer Pointer to the buffer pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_byte_buffer_destroy(uint8_t** buffer);

// ===== Callback Typedefs =====
typedef void (*mavsdk_mavlink_direct_message_callback_t)(const mavsdk_mavlink_direct_mavlink_message_t message, void* user_data);

// ===== MavlinkDirect Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_mavlink_direct_t mavsdk_mavlink_direct_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_mavlink_direct_destroy(mavsdk_mavlink_direct_t mavlink_direct);

// ===== Methods =====

/**
 * @brief Get the current send message (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param send_message_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_mavlink_direct_result_t
mavsdk_mavlink_direct_send_message(
    mavsdk_mavlink_direct_t mavlink_direct,
    mavsdk_mavlink_direct_mavlink_message_t message);


/**
 * @brief Subscribe to incoming MAVLink messages.
 * 
 *  This provides direct access to incoming MAVLink messages. Use an empty string
 *  in message_name to subscribe to all messages, or specify a message name
 *  (e.g., "HEARTBEAT") to filter for specific message types.
 *
 * @param mavlink_direct The mavlink_direct instance.
* @param message_name  MAVLink message name to filter for (e.g., "HEARTBEAT"), empty string = all messages
 * 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 * @return Handle for this subscription. Use mavsdk_mavlink_direct_unsubscribe_message() to unsubscribe.
 */
CMAVSDK_EXPORT mavsdk_mavlink_direct_message_handle_t mavsdk_mavlink_direct_subscribe_message(
    mavsdk_mavlink_direct_t mavlink_direct,
    char* message_name,
    mavsdk_mavlink_direct_message_callback_t callback,
    void* user_data);

/**
 * @brief Unsubscribe from 'message' updates.
 *
 * Stops the subscription and frees resources associated with the handle.
 *
 * @param mavlink_direct The mavlink_direct instance.
 * @param handle The subscription handle returned by mavsdk_mavlink_direct_subscribe_message().
 */
CMAVSDK_EXPORT void mavsdk_mavlink_direct_unsubscribe_message(
    mavsdk_mavlink_direct_t mavlink_direct,
    mavsdk_mavlink_direct_message_handle_t);


/**
 * @brief Get the current load custom xml (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param load_custom_xml_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_mavlink_direct_result_t
mavsdk_mavlink_direct_load_custom_xml(
    mavsdk_mavlink_direct_t mavlink_direct,
    char* xml_content);


#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_MAVLINK_DIRECT_H