// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/winch/winch.proto)

#ifndef CMAVSDK_WINCH_H
#define CMAVSDK_WINCH_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Allows users to send winch actions, as well as receive status information from winch systems.
 */

// ===== Forward Declarations =====
typedef void* mavsdk_system_t;

// ===== Opaque Handles =====
typedef void* mavsdk_winch_t;
typedef void* mavsdk_winch_status_handle_t;

// ===== Enums =====
/**
 * @brief Winch Action type.
 */
typedef enum {
    /**  Allow motor to freewheel. */
    MAVSDK_WINCH_WINCH_ACTION_RELAXED = 0,
    /**  Wind or unwind specified length of line, optionally using specified rate. */
    MAVSDK_WINCH_WINCH_ACTION_RELATIVE_LENGTH_CONTROL = 1,
    /**  Wind or unwind line at specified rate. */
    MAVSDK_WINCH_WINCH_ACTION_RATE_CONTROL = 2,
    /**  Perform the locking sequence to relieve motor while in the fully retracted position. */
    MAVSDK_WINCH_WINCH_ACTION_LOCK = 3,
    /**  Sequence of drop, slow down, touch down, reel up, lock. */
    MAVSDK_WINCH_WINCH_ACTION_DELIVER = 4,
    /**  Engage motor and hold current position. */
    MAVSDK_WINCH_WINCH_ACTION_HOLD = 5,
    /**  Return the reel to the fully retracted position. */
    MAVSDK_WINCH_WINCH_ACTION_RETRACT = 6,
    /**  Load the reel with line. The winch will calculate the total loaded length and stop when the tension exceeds a threshold. */
    MAVSDK_WINCH_WINCH_ACTION_LOAD_LINE = 7,
    /**  Spool out the entire length of the line. */
    MAVSDK_WINCH_WINCH_ACTION_ABANDON_LINE = 8,
    /**  Spools out just enough to present the hook to the user to load the payload. */
    MAVSDK_WINCH_WINCH_ACTION_LOAD_PAYLOAD = 9,
} mavsdk_winch_winch_action_t;


// ===== Structs =====
/**
 * @brief Winch Status Flags.
 * 
 *  The status flags are defined in mavlink
 *  https://mavlink.io/en/messages/common.html#MAV_WINCH_STATUS_FLAG.
 * 
 *  Multiple status fields can be set simultaneously. Mavlink does
 *  not specify which states are mutually exclusive.
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_winch_status_flags_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  Winch is healthy */
    bool healthy;
    /**  Winch line is fully retracted */
    bool fully_retracted;
    /**  Winch motor is moving */
    bool moving;
    /**  Winch clutch is engaged allowing motor to move freely */
    bool clutch_engaged;
    /**  Winch is locked by locking mechanism */
    bool locked;
    /**  Winch is gravity dropping payload */
    bool dropping;
    /**  Winch is arresting payload descent */
    bool arresting;
    /**  Winch is using torque measurements to sense the ground */
    bool ground_sense;
    /**  Winch is returning to the fully retracted position */
    bool retracting;
    /**  Winch is redelivering the payload. This is a failover state if the line tension goes above a threshold during RETRACTING. */
    bool redeliver;
    /**  Winch is abandoning the line and possibly payload. Winch unspools the entire calculated line length. This is a failover state from REDELIVER if the number of attempts exceeds a threshold. */
    bool abandon_line;
    /**  Winch is engaging the locking mechanism */
    bool locking;
    /**  Winch is spooling on line */
    bool load_line;
    /**  Winch is loading a payload */
    bool load_payload;
} mavsdk_winch_status_flags_t;

/**
 * @brief Destroy a status_flags struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_winch_status_flags_destroy(
    mavsdk_winch_status_flags_t* target);

/**
 * @brief Destroy an array of status_flags structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_winch_status_flags_array_destroy(
    mavsdk_winch_status_flags_t** array,
    size_t size);

/**
 * @brief Status type.
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_winch_status_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  Time in usec */
    uint64_t time_usec;
    /**  Length of the line in meters */
    float line_length_m;
    /**  Speed in meters per second */
    float speed_m_s;
    /**  Tension in kilograms */
    float tension_kg;
    /**  Voltage in volts */
    float voltage_v;
    /**  Current in amperes */
    float current_a;
    /**  Temperature in Celsius */
    int32_t temperature_c;
    /**  Status flags */
    mavsdk_winch_status_flags_t status_flags;
} mavsdk_winch_status_t;

/**
 * @brief Destroy a status struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_winch_status_destroy(
    mavsdk_winch_status_t* target);

/**
 * @brief Destroy an array of status structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_winch_status_array_destroy(
    mavsdk_winch_status_t** array,
    size_t size);

/**
 * @brief Possible results returned for winch action requests.
 */
typedef enum {
    /**  Unknown result. */
    MAVSDK_WINCH_RESULT_UNKNOWN = 0,
    /**  Request was successful. */
    MAVSDK_WINCH_RESULT_SUCCESS = 1,
    /**  No system is connected. */
    MAVSDK_WINCH_RESULT_NO_SYSTEM = 2,
    /**  Temporarily rejected. */
    MAVSDK_WINCH_RESULT_BUSY = 3,
    /**  Request timed out. */
    MAVSDK_WINCH_RESULT_TIMEOUT = 4,
    /**  Action not supported. */
    MAVSDK_WINCH_RESULT_UNSUPPORTED = 5,
    /**  Action failed. */
    MAVSDK_WINCH_RESULT_FAILED = 6,
} mavsdk_winch_result_t;



// ===== Primitive Array Destroy Functions =====
/**
 * @brief Destroy an array of float.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_float_array_destroy(float** array);
/**
 * @brief Destroy an array of double.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_double_array_destroy(double** array);
/**
 * @brief Destroy an array of int32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_int32t_array_destroy(int32_t** array);
/**
 * @brief Destroy an array of uint32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_uint32t_array_destroy(uint32_t** array);
/**
 * @brief Destroy an array of int64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_int64t_array_destroy(int64_t** array);
/**
 * @brief Destroy an array of uint64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_uint64t_array_destroy(uint64_t** array);
/**
 * @brief Destroy an array of bool.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_bool_array_destroy(bool** array);

/**
 * @brief Destroy a string (char*).
 *
 * Frees the memory allocated for the string.
 *
 * @param str Pointer to the string pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_string_destroy(char** str);

/**
 * @brief Destroy a byte buffer (uint8_t*).
 *
 * Frees the memory allocated for the byte buffer.
 *
 * @param buffer Pointer to the buffer pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_winch_byte_buffer_destroy(uint8_t** buffer);

// ===== Callback Typedefs =====
typedef void (*mavsdk_winch_status_callback_t)(const mavsdk_winch_status_t status, void* user_data);
typedef void (*mavsdk_winch_relax_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_relative_length_control_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_rate_control_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_lock_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_deliver_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_hold_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_retract_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_load_line_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_abandon_line_callback_t)(const mavsdk_winch_result_t result, void* user_data);
typedef void (*mavsdk_winch_load_payload_callback_t)(const mavsdk_winch_result_t result, void* user_data);

// ===== Winch Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_winch_t mavsdk_winch_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_winch_destroy(mavsdk_winch_t winch);

// ===== Methods =====

/**
 * @brief Subscribe to 'winch status' updates.
 *
 * @param winch The winch instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 * @return Handle for this subscription. Use mavsdk_winch_unsubscribe_status() to unsubscribe.
 */
CMAVSDK_EXPORT mavsdk_winch_status_handle_t mavsdk_winch_subscribe_status(
    mavsdk_winch_t winch,
    mavsdk_winch_status_callback_t callback,
    void* user_data);

/**
 * @brief Unsubscribe from 'status' updates.
 *
 * Stops the subscription and frees resources associated with the handle.
 *
 * @param winch The winch instance.
 * @param handle The subscription handle returned by mavsdk_winch_subscribe_status().
 */
CMAVSDK_EXPORT void mavsdk_winch_unsubscribe_status(
    mavsdk_winch_t winch,
    mavsdk_winch_status_handle_t);

/**
 * @brief Get the current status (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param status_out Pointer to store the result.
 */
CMAVSDK_EXPORT
void
mavsdk_winch_status(
    mavsdk_winch_t winch,
    mavsdk_winch_status_t* status_out);


/**
 * @brief Allow motor to freewheel.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_relax_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_relax_callback_t callback,
    void* user_data);


/**
 * @brief Get the current relax (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param relax_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_relax(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Wind or unwind specified length of line, optionally using specified rate.
 *
 * @param winch The winch instance.
* @param instance  Instance ID of the winch addressed by this request
 * 
* @param length_m  Length of line to unwind or wind
 * 
* @param rate_m_s  Rate at which to wind or unwind the line
 * 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_relative_length_control_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    float length_m,
    float rate_m_s,
    mavsdk_winch_relative_length_control_callback_t callback,
    void* user_data);


/**
 * @brief Get the current relative length control (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param relative_length_control_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_relative_length_control(
    mavsdk_winch_t winch,
    uint32_t instance,
    float length_m,
    float rate_m_s);


/**
 * @brief Wind or unwind line at specified rate.
 *
 * @param winch The winch instance.
* @param instance 
* @param rate_m_s  Rate at which to wind or unwind the line
 * 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_rate_control_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    float rate_m_s,
    mavsdk_winch_rate_control_callback_t callback,
    void* user_data);


/**
 * @brief Get the current rate control (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param rate_control_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_rate_control(
    mavsdk_winch_t winch,
    uint32_t instance,
    float rate_m_s);


/**
 * @brief Perform the locking sequence to relieve motor while in the fully retracted position.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_lock_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_lock_callback_t callback,
    void* user_data);


/**
 * @brief Get the current lock (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param lock_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_lock(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Sequence of drop, slow down, touch down, reel up, lock.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_deliver_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_deliver_callback_t callback,
    void* user_data);


/**
 * @brief Get the current deliver (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param deliver_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_deliver(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Engage motor and hold current position.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_hold_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_hold_callback_t callback,
    void* user_data);


/**
 * @brief Get the current hold (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param hold_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_hold(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Return the reel to the fully retracted position.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_retract_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_retract_callback_t callback,
    void* user_data);


/**
 * @brief Get the current retract (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param retract_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_retract(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Load the reel with line.
 * 
 *  The winch will calculate the total loaded length and stop when the tension exceeds a threshold.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_load_line_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_load_line_callback_t callback,
    void* user_data);


/**
 * @brief Get the current load line (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param load_line_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_load_line(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Spool out the entire length of the line.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_abandon_line_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_abandon_line_callback_t callback,
    void* user_data);


/**
 * @brief Get the current abandon line (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param abandon_line_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_abandon_line(
    mavsdk_winch_t winch,
    uint32_t instance);


/**
 * @brief Spools out just enough to present the hook to the user to load the payload.
 *
 * @param winch The winch instance.
* @param instance 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_winch_load_payload_async(
    mavsdk_winch_t winch,
    uint32_t instance,
    mavsdk_winch_load_payload_callback_t callback,
    void* user_data);


/**
 * @brief Get the current load payload (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param load_payload_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_winch_result_t
mavsdk_winch_load_payload(
    mavsdk_winch_t winch,
    uint32_t instance);


#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_WINCH_H