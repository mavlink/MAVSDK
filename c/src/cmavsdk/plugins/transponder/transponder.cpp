// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/transponder/transponder.proto)

#include "transponder.h"

#include <mavsdk/plugins/transponder/transponder.h>
#include <cstring>
#include <vector>

// ===== C++ to C Type Conversions =====

static mavsdk_transponder_result_t
translate_result(mavsdk::Transponder::Result cpp_result) {
    switch(cpp_result) {
        case mavsdk::Transponder::Result::Unknown:
            return MAVSDK_TRANSPONDER_RESULT_UNKNOWN;
        case mavsdk::Transponder::Result::Success:
            return MAVSDK_TRANSPONDER_RESULT_SUCCESS;
        case mavsdk::Transponder::Result::NoSystem:
            return MAVSDK_TRANSPONDER_RESULT_NO_SYSTEM;
        case mavsdk::Transponder::Result::ConnectionError:
            return MAVSDK_TRANSPONDER_RESULT_CONNECTION_ERROR;
        case mavsdk::Transponder::Result::Busy:
            return MAVSDK_TRANSPONDER_RESULT_BUSY;
        case mavsdk::Transponder::Result::CommandDenied:
            return MAVSDK_TRANSPONDER_RESULT_COMMAND_DENIED;
        case mavsdk::Transponder::Result::Timeout:
            return MAVSDK_TRANSPONDER_RESULT_TIMEOUT;
    }
}

static mavsdk::Transponder::AdsbEmitterType
translate_adsb_emitter_type_from_c(mavsdk_transponder_adsb_emitter_type_t c_enum) {
    switch(c_enum) {
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_NO_INFO:
            return mavsdk::Transponder::AdsbEmitterType::NoInfo;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHT:
            return mavsdk::Transponder::AdsbEmitterType::Light;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SMALL:
            return mavsdk::Transponder::AdsbEmitterType::Small;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LARGE:
            return mavsdk::Transponder::AdsbEmitterType::Large;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGH_VORTEX_LARGE:
            return mavsdk::Transponder::AdsbEmitterType::HighVortexLarge;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HEAVY:
            return mavsdk::Transponder::AdsbEmitterType::Heavy;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGHLY_MANUV:
            return mavsdk::Transponder::AdsbEmitterType::HighlyManuv;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ROTOCRAFT:
            return mavsdk::Transponder::AdsbEmitterType::Rotocraft;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED:
            return mavsdk::Transponder::AdsbEmitterType::Unassigned;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_GLIDER:
            return mavsdk::Transponder::AdsbEmitterType::Glider;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHTER_AIR:
            return mavsdk::Transponder::AdsbEmitterType::LighterAir;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_PARACHUTE:
            return mavsdk::Transponder::AdsbEmitterType::Parachute;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ULTRA_LIGHT:
            return mavsdk::Transponder::AdsbEmitterType::UltraLight;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED2:
            return mavsdk::Transponder::AdsbEmitterType::Unassigned2;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UAV:
            return mavsdk::Transponder::AdsbEmitterType::Uav;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SPACE:
            return mavsdk::Transponder::AdsbEmitterType::Space;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSGINED3:
            return mavsdk::Transponder::AdsbEmitterType::Unassgined3;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_EMERGENCY_SURFACE:
            return mavsdk::Transponder::AdsbEmitterType::EmergencySurface;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SERVICE_SURFACE:
            return mavsdk::Transponder::AdsbEmitterType::ServiceSurface;
        case MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_POINT_OBSTACLE:
            return mavsdk::Transponder::AdsbEmitterType::PointObstacle;
    }
    return mavsdk::Transponder::AdsbEmitterType::NoInfo;
}

static mavsdk_transponder_adsb_emitter_type_t
translate_adsb_emitter_type_to_c(mavsdk::Transponder::AdsbEmitterType cpp_enum) {
    switch(cpp_enum) {
        case mavsdk::Transponder::AdsbEmitterType::NoInfo:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_NO_INFO;
        case mavsdk::Transponder::AdsbEmitterType::Light:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHT;
        case mavsdk::Transponder::AdsbEmitterType::Small:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SMALL;
        case mavsdk::Transponder::AdsbEmitterType::Large:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LARGE;
        case mavsdk::Transponder::AdsbEmitterType::HighVortexLarge:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGH_VORTEX_LARGE;
        case mavsdk::Transponder::AdsbEmitterType::Heavy:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HEAVY;
        case mavsdk::Transponder::AdsbEmitterType::HighlyManuv:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGHLY_MANUV;
        case mavsdk::Transponder::AdsbEmitterType::Rotocraft:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ROTOCRAFT;
        case mavsdk::Transponder::AdsbEmitterType::Unassigned:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED;
        case mavsdk::Transponder::AdsbEmitterType::Glider:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_GLIDER;
        case mavsdk::Transponder::AdsbEmitterType::LighterAir:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHTER_AIR;
        case mavsdk::Transponder::AdsbEmitterType::Parachute:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_PARACHUTE;
        case mavsdk::Transponder::AdsbEmitterType::UltraLight:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ULTRA_LIGHT;
        case mavsdk::Transponder::AdsbEmitterType::Unassigned2:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED2;
        case mavsdk::Transponder::AdsbEmitterType::Uav:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UAV;
        case mavsdk::Transponder::AdsbEmitterType::Space:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SPACE;
        case mavsdk::Transponder::AdsbEmitterType::Unassgined3:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSGINED3;
        case mavsdk::Transponder::AdsbEmitterType::EmergencySurface:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_EMERGENCY_SURFACE;
        case mavsdk::Transponder::AdsbEmitterType::ServiceSurface:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SERVICE_SURFACE;
        case mavsdk::Transponder::AdsbEmitterType::PointObstacle:
            return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_POINT_OBSTACLE;
    }
    return MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_NO_INFO;
}

static mavsdk::Transponder::AdsbAltitudeType
translate_adsb_altitude_type_from_c(mavsdk_transponder_adsb_altitude_type_t c_enum) {
    switch(c_enum) {
        case MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_PRESSURE_QNH:
            return mavsdk::Transponder::AdsbAltitudeType::PressureQnh;
        case MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_GEOMETRIC:
            return mavsdk::Transponder::AdsbAltitudeType::Geometric;
    }
    return mavsdk::Transponder::AdsbAltitudeType::PressureQnh;
}

static mavsdk_transponder_adsb_altitude_type_t
translate_adsb_altitude_type_to_c(mavsdk::Transponder::AdsbAltitudeType cpp_enum) {
    switch(cpp_enum) {
        case mavsdk::Transponder::AdsbAltitudeType::PressureQnh:
            return MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_PRESSURE_QNH;
        case mavsdk::Transponder::AdsbAltitudeType::Geometric:
            return MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_GEOMETRIC;
    }
    return MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_PRESSURE_QNH;
}



static mavsdk::Transponder::AdsbVehicle
translate_adsb_vehicle_from_c(const mavsdk_transponder_adsb_vehicle_t& c_struct) {
    mavsdk::Transponder::AdsbVehicle cpp_struct{};
    cpp_struct.icao_address = c_struct.icao_address;
    cpp_struct.latitude_deg = c_struct.latitude_deg;
    cpp_struct.longitude_deg = c_struct.longitude_deg;
    cpp_struct.altitude_type = translate_adsb_altitude_type_from_c(c_struct.altitude_type);
    cpp_struct.absolute_altitude_m = c_struct.absolute_altitude_m;
    cpp_struct.heading_deg = c_struct.heading_deg;
    cpp_struct.horizontal_velocity_m_s = c_struct.horizontal_velocity_m_s;
    cpp_struct.vertical_velocity_m_s = c_struct.vertical_velocity_m_s;
    if (c_struct.callsign) {
        cpp_struct.callsign = c_struct.callsign;
    }
    cpp_struct.emitter_type = translate_adsb_emitter_type_from_c(c_struct.emitter_type);
    cpp_struct.squawk = c_struct.squawk;
    cpp_struct.tslc_s = c_struct.tslc_s;
    return cpp_struct;
}

static mavsdk_transponder_adsb_vehicle_t
translate_adsb_vehicle_to_c(const mavsdk::Transponder::AdsbVehicle& cpp_struct) {
    mavsdk_transponder_adsb_vehicle_t c_struct{};
    c_struct.icao_address = cpp_struct.icao_address;
    c_struct.latitude_deg = cpp_struct.latitude_deg;
    c_struct.longitude_deg = cpp_struct.longitude_deg;
    c_struct.altitude_type = translate_adsb_altitude_type_to_c(cpp_struct.altitude_type);
    c_struct.absolute_altitude_m = cpp_struct.absolute_altitude_m;
    c_struct.heading_deg = cpp_struct.heading_deg;
    c_struct.horizontal_velocity_m_s = cpp_struct.horizontal_velocity_m_s;
    c_struct.vertical_velocity_m_s = cpp_struct.vertical_velocity_m_s;
    c_struct.callsign = strdup(cpp_struct.callsign.c_str());
    c_struct.emitter_type = translate_adsb_emitter_type_to_c(cpp_struct.emitter_type);
    c_struct.squawk = cpp_struct.squawk;
    c_struct.tslc_s = cpp_struct.tslc_s;
    return c_struct;
}

void mavsdk_transponder_adsb_vehicle_destroy(
    mavsdk_transponder_adsb_vehicle_t* target) {
    if (!target) return;
    if (target->callsign) {
        free((void*)target->callsign);
        target->callsign = nullptr;
    }
}

void mavsdk_transponder_adsb_vehicle_array_destroy(
    mavsdk_transponder_adsb_vehicle_t** array,
    size_t size) {
    if (!array || !*array) return;

    for (size_t i = 0; i < size; i++) {
        mavsdk_transponder_adsb_vehicle_destroy(&(*array)[i]);
    }

    delete[] *array;
    *array = nullptr;
}



// ===== Primitive Array Destroy Functions =====
void mavsdk_transponder_float_array_destroy(float** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_double_array_destroy(double** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_int32t_array_destroy(int32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_uint32t_array_destroy(uint32_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_int64t_array_destroy(int64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_uint64t_array_destroy(uint64_t** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}

void mavsdk_transponder_bool_array_destroy(bool** array) {
    if (!array || !*array) return;
    delete[] *array;
    *array = nullptr;
}


void mavsdk_transponder_string_destroy(char** str) {
    if (!str || !*str) return;
    free(*str);
    *str = nullptr;
}

void mavsdk_transponder_byte_buffer_destroy(uint8_t** buffer) {
    if (!buffer || !*buffer) return;
    delete[] *buffer;
    *buffer = nullptr;
}

// ===== Transponder Wrapper =====

struct mavsdk_transponder_wrapper {
    std::shared_ptr<mavsdk::Transponder> cpp_plugin;
};

mavsdk_transponder_t
mavsdk_transponder_create(mavsdk_system_t system) {
    if (system == nullptr) {
        return nullptr;
    }

    auto wrapper = new mavsdk_transponder_wrapper();
    auto system_ptr = reinterpret_cast<std::shared_ptr<mavsdk::System>*>(system);
    wrapper->cpp_plugin = std::make_shared<mavsdk::Transponder>(*system_ptr);

    return reinterpret_cast<mavsdk_transponder_t>(wrapper);
}

void mavsdk_transponder_destroy(mavsdk_transponder_t transponder) {
    if (transponder == nullptr) {
        return;
    }

    auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);
    delete wrapper;
}

// ===== Method Implementations =====

// Transponder async
mavsdk_transponder_transponder_handle_t mavsdk_transponder_subscribe_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_transponder_callback_t callback,
    void* user_data)
{
    auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);

    auto cpp_handle =    wrapper->cpp_plugin->subscribe_transponder(
        [callback, user_data](
            mavsdk::Transponder::AdsbVehicle value) {
                if (callback) {
                    callback(
                        translate_adsb_vehicle_to_c(value),
                        user_data);
                }
        });

    auto handle_wrapper = new mavsdk::Transponder::TransponderHandle(std::move(cpp_handle));
    return reinterpret_cast<mavsdk_transponder_transponder_handle_t>(handle_wrapper);
}

void mavsdk_transponder_unsubscribe_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_transponder_handle_t handle)
{
    if (handle) {
        auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);
        auto cpp_handle = reinterpret_cast<mavsdk::Transponder::TransponderHandle*>(handle);
        wrapper->cpp_plugin->unsubscribe_transponder(std::move(*cpp_handle));
        delete cpp_handle;
    }
}

// Transponder sync
void
mavsdk_transponder_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_adsb_vehicle_t* transponder_out)
{
    auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);

    auto ret_value = wrapper->cpp_plugin->transponder();

    if (transponder_out != nullptr) {
        *transponder_out = translate_adsb_vehicle_to_c(ret_value);
    }
}

// SetRateTransponder async
void mavsdk_transponder_set_rate_transponder_async(
    mavsdk_transponder_t transponder,
    double rate_hz,
    mavsdk_transponder_set_rate_transponder_callback_t callback,
    void* user_data)
{
    auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);

    wrapper->cpp_plugin->set_rate_transponder_async(
        rate_hz,
        [callback, user_data](
            mavsdk::Transponder::Result result) {
                if (callback) {
                    callback(
                        translate_result(result),
                        user_data);
                }
        });
}


// SetRateTransponder sync
mavsdk_transponder_result_t
mavsdk_transponder_set_rate_transponder(
    mavsdk_transponder_t transponder,
    double rate_hz)
{
    auto wrapper = reinterpret_cast<mavsdk_transponder_wrapper*>(transponder);

    auto ret_value = wrapper->cpp_plugin->set_rate_transponder(        rate_hz);

    return translate_result(ret_value);
}
