// WARNING: THIS FILE IS AUTOGENERATED! As such, it should not be edited.
// Edits need to be made to the proto files
// (see https://github.com/mavlink/MAVSDK-Proto/blob/main/protos/transponder/transponder.proto)

#ifndef CMAVSDK_TRANSPONDER_H
#define CMAVSDK_TRANSPONDER_H

#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include "cmavsdk/mavsdk_export.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief Allow users to get ADS-B information
 * and set ADS-B update rates.
 */

// ===== Forward Declarations =====
typedef struct mavsdk_system_s *mavsdk_system_t;

// ===== Opaque Handles =====
typedef struct mavsdk_transponder_s *mavsdk_transponder_t;
typedef struct mavsdk_transponder_transponder_handle_s *mavsdk_transponder_transponder_handle_t;

// ===== Enums =====
/**
 * @brief ADSB classification for the type of vehicle emitting the transponder signal.
 */
typedef enum {
    /**  No emitter info.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_NO_INFO = 0,
    /**  Light emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHT = 1,
    /**  Small emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SMALL = 2,
    /**  Large emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LARGE = 3,
    /**  High vortex emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGH_VORTEX_LARGE = 4,
    /**  Heavy emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HEAVY = 5,
    /**  Highly maneuverable emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_HIGHLY_MANUV = 6,
    /**  Rotorcraft emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ROTOCRAFT = 7,
    /**  Unassigned emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED = 8,
    /**  Glider emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_GLIDER = 9,
    /**  Lighter air emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_LIGHTER_AIR = 10,
    /**  Parachute emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_PARACHUTE = 11,
    /**  Ultra light emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_ULTRA_LIGHT = 12,
    /**  Unassigned2 emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSIGNED2 = 13,
    /**  UAV emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UAV = 14,
    /**  Space emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SPACE = 15,
    /**  Unassigned3 emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_UNASSGINED3 = 16,
    /**  Emergency emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_EMERGENCY_SURFACE = 17,
    /**  Service surface emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_SERVICE_SURFACE = 18,
    /**  Point obstacle emitter.. */
    MAVSDK_TRANSPONDER_ADSB_EMITTER_TYPE_POINT_OBSTACLE = 19,
} mavsdk_transponder_adsb_emitter_type_t;

/**
 * @brief Altitude type used in AdsbVehicle message
 */
typedef enum {
    /**  Altitude reported from a Baro source using QNH reference. */
    MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_PRESSURE_QNH = 0,
    /**  Altitude reported from a GNSS source. */
    MAVSDK_TRANSPONDER_ADSB_ALTITUDE_TYPE_GEOMETRIC = 1,
} mavsdk_transponder_adsb_altitude_type_t;


// ===== Structs =====
/**
 * @brief ADSB Vehicle type.
 *
 * @note This struct may contain dynamically allocated memory. Always call
 *       mavsdk_transponder_adsb_vehicle_destroy() when done to avoid memory leaks.
 */
typedef struct CMAVSDK_EXPORT {
    /**  ICAO (International Civil Aviation Organization) unique worldwide identifier */
    uint32_t icao_address;
    /**  Latitude in degrees (range: -90 to +90) */
    double latitude_deg;
    /**  Longitude in degrees (range: -180 to +180). */
    double longitude_deg;
    /**  ADSB altitude type. */
    mavsdk_transponder_adsb_altitude_type_t altitude_type;
    /**  Altitude in metres according to altitude_type */
    float absolute_altitude_m;
    /**  Course over ground, in degrees */
    float heading_deg;
    /**  The horizontal velocity in metres/second */
    float horizontal_velocity_m_s;
    /**  The vertical velocity in metres/second. Positive is up. */
    float vertical_velocity_m_s;
    /**  The callsign */
    char* callsign;
    /**  ADSB emitter type. */
    mavsdk_transponder_adsb_emitter_type_t emitter_type;
    /**  Squawk code. */
    uint32_t squawk;
    /**  Time Since Last Communication in seconds. */
    uint32_t tslc_s;
} mavsdk_transponder_adsb_vehicle_t;

/**
 * @brief Destroy a adsb_vehicle struct.
 *
 * Frees all memory allocated by MAVSDK for this struct, including any
 * dynamically allocated arrays or strings. Must be called to avoid memory leaks.
 * Always call this function when done with the struct, even if it currently
 * contains no dynamic allocations.
 *
 * @param target Pointer to the struct to destroy. Can be NULL (no-op).
 */
CMAVSDK_EXPORT void mavsdk_transponder_adsb_vehicle_destroy(
    mavsdk_transponder_adsb_vehicle_t* target);

/**
 * @brief Destroy an array of adsb_vehicle structs.
 *
 * Frees all memory allocated for the array and its elements, including any
 * nested dynamic allocations. Must be called to avoid memory leaks.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 * @param size Number of elements in the array.
 */
CMAVSDK_EXPORT void mavsdk_transponder_adsb_vehicle_array_destroy(
    mavsdk_transponder_adsb_vehicle_t** array,
    size_t size);

/**
 * @brief Possible results returned for transponder requests.
 */
typedef enum {
    /**  Unknown result. */
    MAVSDK_TRANSPONDER_RESULT_UNKNOWN = 0,
    /**  Success: the transponder command was accepted by the vehicle. */
    MAVSDK_TRANSPONDER_RESULT_SUCCESS = 1,
    /**  No system connected. */
    MAVSDK_TRANSPONDER_RESULT_NO_SYSTEM = 2,
    /**  Connection error. */
    MAVSDK_TRANSPONDER_RESULT_CONNECTION_ERROR = 3,
    /**  Vehicle is busy. */
    MAVSDK_TRANSPONDER_RESULT_BUSY = 4,
    /**  Command refused by vehicle. */
    MAVSDK_TRANSPONDER_RESULT_COMMAND_DENIED = 5,
    /**  Request timed out. */
    MAVSDK_TRANSPONDER_RESULT_TIMEOUT = 6,
} mavsdk_transponder_result_t;



// ===== Primitive Array Destroy Functions =====
/**
 * @brief Destroy an array of float.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_float_array_destroy(float** array);
/**
 * @brief Destroy an array of double.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_double_array_destroy(double** array);
/**
 * @brief Destroy an array of int32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_int32t_array_destroy(int32_t** array);
/**
 * @brief Destroy an array of uint32_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_uint32t_array_destroy(uint32_t** array);
/**
 * @brief Destroy an array of int64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_int64t_array_destroy(int64_t** array);
/**
 * @brief Destroy an array of uint64_t.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_uint64t_array_destroy(uint64_t** array);
/**
 * @brief Destroy an array of bool.
 *
 * Frees the memory allocated for the array.
 *
 * @param array Pointer to the array pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_bool_array_destroy(bool** array);

/**
 * @brief Destroy a string (char*).
 *
 * Frees the memory allocated for the string.
 *
 * @param str Pointer to the string pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_string_destroy(char** str);

/**
 * @brief Destroy a byte buffer (uint8_t*).
 *
 * Frees the memory allocated for the byte buffer.
 *
 * @param buffer Pointer to the buffer pointer. Will be set to NULL after freeing.
 */
CMAVSDK_EXPORT void mavsdk_transponder_byte_buffer_destroy(uint8_t** buffer);

// ===== Callback Typedefs =====
typedef void (*mavsdk_transponder_transponder_callback_t)(const mavsdk_transponder_adsb_vehicle_t transponder, void* user_data);
typedef void (*mavsdk_transponder_set_rate_transponder_callback_t)(const mavsdk_transponder_result_t result, void* user_data);

// ===== Transponder Creation/Destruction =====
CMAVSDK_EXPORT mavsdk_transponder_t mavsdk_transponder_create(mavsdk_system_t system);
CMAVSDK_EXPORT void mavsdk_transponder_destroy(mavsdk_transponder_t transponder);

// ===== Methods =====

/**
 * @brief Subscribe to 'transponder' updates.
 *
 * @param transponder The transponder instance.
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 * @return Handle for this subscription. Use mavsdk_transponder_unsubscribe_transponder() to unsubscribe.
 */
CMAVSDK_EXPORT mavsdk_transponder_transponder_handle_t mavsdk_transponder_subscribe_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_transponder_callback_t callback,
    void* user_data);

/**
 * @brief Unsubscribe from 'transponder' updates.
 *
 * Stops the subscription and frees resources associated with the handle.
 *
 * @param transponder The transponder instance.
 * @param handle The subscription handle returned by mavsdk_transponder_subscribe_transponder().
 */
CMAVSDK_EXPORT void mavsdk_transponder_unsubscribe_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_transponder_handle_t);

/**
 * @brief Get the current transponder (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param transponder_out Pointer to store the result.
 */
CMAVSDK_EXPORT
void
mavsdk_transponder_transponder(
    mavsdk_transponder_t transponder,
    mavsdk_transponder_adsb_vehicle_t* transponder_out);


/**
 * @brief Set rate to 'transponder' updates.
 *
 * @param transponder The transponder instance.
* @param rate_hz  The requested rate (in Hertz)
 * 
 * @param callback Function to call when new data is available.
 * @param user_data User data to pass to the callback.
 */
CMAVSDK_EXPORT void mavsdk_transponder_set_rate_transponder_async(
    mavsdk_transponder_t transponder,
    double rate_hz,
    mavsdk_transponder_set_rate_transponder_callback_t callback,
    void* user_data);


/**
 * @brief Get the current set rate transponder (blocking).
 *
 * This function blocks until a value is available.
 *
 * @param telemetry The telemetry instance.
 * @param set_rate_transponder_out Pointer to store the result.
 */
CMAVSDK_EXPORT
mavsdk_transponder_result_t
mavsdk_transponder_set_rate_transponder(
    mavsdk_transponder_t transponder,
    double rate_hz);


#ifdef __cplusplus
}
#endif

#endif // CMAVSDK_TRANSPONDER_H